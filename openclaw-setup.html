<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OpenClaw Setup Eastern Shore Maryland | Eastern Shore AI</title>
  <meta name="description" content="OpenClaw Setup Eastern Shore Maryland: $100, no additional fees, 30 days of technical support, secure setup and hardening." />
  <meta property="og:title" content="OpenClaw Setup Eastern Shore Maryland | Eastern Shore AI" />
  <meta property="og:description" content="OpenClaw Setup: $100, no additional fees, 30 days of technical support, secure setup and hardening." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.easternshore.ai/openclaw-setup.html" />
  <meta property="og:image" content="https://www.easternshore.ai/carousel.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="OpenClaw Setup Eastern Shore Maryland | Eastern Shore AI" />
  <meta name="twitter:description" content="OpenClaw Setup: $100, no additional fees, 30 days of technical support, secure setup and hardening." />
  <meta name="twitter:image" content="https://www.easternshore.ai/carousel.png" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="canonical" href="https://www.easternshore.ai/openclaw-setup.html" />
  <link rel="stylesheet" href="/fonts.css" />
  <style>
    /* ===== Theme & CSS Variables ===== */
    :root { --bg:#0a0b10; --bg2:#10121a; --card:#141620; --text:#d8dce8; --muted:#7a7e96; --cyan:#00e5ff; --line:#222438; --violet:#c850ff; }

    * { box-sizing:border-box; }
    html { scroll-behavior:smooth; overflow-x:hidden; max-width:100vw; }
    body { margin:0; font-family:'Titillium Web',system-ui,-apple-system,Segoe UI,Roboto,sans-serif; color:var(--text);
      background:var(--bg); overflow-x:hidden; max-width:100vw; }
    main { display:block; overflow-x:hidden; position:relative; width:100%; }
    .container { max-width:1100px; margin:0 auto; padding:1.2rem; overflow-x:clip; }
    a { color:#ff4fd8; text-shadow:0 0 8px rgba(255,79,216,0.35); }
    /* ===== Battle-Damaged Hull Edges (clip-path) ===== */
    .card,
    .faq-item,
    .success-modal,
    .book-pay-panel,
    .flow-detail,
    .admin-calendar-wrap,
    .admin-lock {
      clip-path: polygon(
        0 8px,
        8px 0,
        35% 0,
        35.5% 4px,
        37% 0,
        calc(100% - 12px) 0,
        100% 12px,
        100% 65%,
        calc(100% - 3px) 66%,
        100% 67.5%,
        100% calc(100% - 6px),
        calc(100% - 6px) 100%,
        62% 100%,
        61.5% calc(100% - 3px),
        60% 100%,
        10px 100%,
        0 calc(100% - 10px),
        3px calc(100% - 14px),
        0 calc(100% - 18px)
      );
      border-radius: 0 !important;
    }
    .btn,
    .btn-primary,
    .top-book-btn {
      clip-path: none;
    }
    /* ===== Cards, Buttons & Forms ===== */
    .card { background:var(--card); border:1px solid var(--line); border-radius:0; padding:1rem; overflow-x:clip; }
    h1, h2, h3, h4 { font-family:'Titillium Web', system-ui, sans-serif; }
    h1 { margin:.2rem 0 .6rem; color:var(--cyan); }
    p { color:var(--muted); line-height:1.6; }
    ul { color:var(--muted); line-height:1.6; }
    .btn { border:1px solid var(--line); background:transparent; color:var(--text); border-radius:2px; padding:.55rem .85rem; cursor:pointer; font-weight:600; font-family:'Titillium Web', system-ui, sans-serif; transition:background 0.15s, color 0.15s, border-color 0.15s; }
    label.btn:hover { background:rgba(255,79,216,0.12); color:#ff4fd8; border-color:#ff4fd8; }
    .btn-primary { background:linear-gradient(145deg,#ff4fd8,#cc3fb0); border-color:#ff4fd8; color:#fff; box-shadow:0 0 16px rgba(255,79,216,0.35); }
    .booking-grid { display:grid; grid-template-columns:1fr 280px; gap:1rem; align-items:start; }
    .booking-grid > * { min-width:0; }
    .book-pay-panel { background:#141620; border:1px solid var(--line); border-radius:0; padding:.9rem; }
    .book-pay-panel p { margin:.2rem 0 .8rem; font-size:.92rem; }
    .btn-wide { width:100%; display:inline-flex; justify-content:center; text-decoration:none; }
    .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:.7rem; margin-top:.7rem; }
    .form-grid > * { min-width:0; overflow:hidden; }
    .full { grid-column:1 / -1; }
    label { display:block; font-size:.85rem; color:var(--muted); margin-bottom:.25rem; }
    input,textarea,select { width:100%; min-width:0; max-width:100%; border:1px solid var(--line); border-radius:2px; background:#10121a; color:var(--text); padding:.65rem .7rem; font:inherit; }
    textarea { min-height:120px; resize:vertical; }
    .form-actions { display:flex; justify-content:flex-end; margin-top:.9rem; }
    .form-status { margin-top:.6rem; color:var(--muted); min-height:1.2em; }
    .form-status.ok { color:#00e5ff; } .form-status.err { color:#ff5555; }

    /* ===== Footer ===== */
    footer {
      margin-top: 2rem;
      padding: 1.5rem 1rem calc(1.5rem + env(safe-area-inset-bottom, 0px));
      color: #7a7e96;
      font-size: 0.85rem;
      border-top: 1px solid var(--line);
    }
    .footer-inner {
      display: flex;
      align-items: flex-start;
      gap: 1.5rem;
      max-width: 1100px;
      margin: 0 auto;
    }
    .footer-newsletter {
      flex: 0.72;
      min-width: 0;
      max-width: 360px;
    }
    .footer-newsletter-label {
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--cyan);
      margin: 0 0 0.4rem;
    }
    .footer-info {
      flex: 1.28;
      text-align: center;
      min-width: 0;
      padding-top: 0.25rem;
    }

    .footer-link {
      display: inline-block;
      margin: 0.2rem 0.4rem 0;
      color: #ff4fd8;
      text-shadow: 0 0 8px rgba(255,79,216,0.35);
      text-decoration: underline;
    }

    .footer-link:hover { color: #ff7ae4; }


    /* ===== Success Modal ===== */
    .success-modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; padding:1rem; z-index:1200; }
    .success-modal-overlay.active { display:flex; }
    #tax-category-modal { z-index: 1250; }
    #tax-category-edit-modal { z-index: 1300; }
    #confirm-modal, #success-modal, #error-modal { z-index: 1400; }
    .success-modal { width:min(560px,96vw); background:linear-gradient(160deg, #141620, #10121a); border:1px solid var(--line); border-radius:0; padding:1rem; }
    .success-modal h3 { margin:.1rem 0 .4rem; color:var(--cyan); }
    .success-modal p { margin:.45rem 0; }
    .error-modal h3 { color:var(--violet); }

    /* Simple modal (re-uses success modal styles) */
    .simple-modal-actions { display:flex; justify-content:flex-end; margin-top:1rem; }
    .simple-modal-links { margin-top:.7rem; display:flex; gap:.8rem; flex-wrap:wrap; }

    /* ===== OpenClaw Info Modal ===== */
    #openclaw-info-modal .success-modal { width:min(700px,96vw); max-height:88vh; overflow-y:auto; }
    .oc-tagline { font-size:1.15rem; font-weight:700; color:var(--text); margin:.2rem 0 .3rem; font-family:'Hanken Grotesk',system-ui,sans-serif; }
    .oc-sub { margin:0 0 1rem; font-size:.95rem; }
    .oc-features { display:grid; grid-template-columns:1fr 1fr; gap:.6rem; margin:.8rem 0; }
    .oc-feature { background:var(--bg2); border:1px solid var(--line); padding:.65rem .75rem; }
    .oc-feature-title { font-weight:700; font-size:.88rem; color:var(--cyan); margin:0 0 .2rem; font-family:'Hanken Grotesk',system-ui,sans-serif; }
    .oc-feature-desc { margin:0; font-size:.83rem; color:var(--muted); line-height:1.45; }
    .oc-integrations { margin:.8rem 0 0; }
    .oc-integrations-label { font-size:.78rem; font-weight:700; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); margin:0 0 .4rem; }
    .oc-chips { display:flex; flex-wrap:wrap; gap:.3rem; }
    .oc-chip { background:var(--bg2); border:1px solid var(--line); font-size:.78rem; color:var(--muted); padding:.2rem .5rem; }
    .oc-quotes { margin:.9rem 0 0; border-top:1px solid var(--line); padding-top:.75rem; display:grid; grid-template-columns:1fr 1fr; gap:.5rem; }
    .oc-quote { font-size:.8rem; color:var(--muted); line-height:1.4; font-style:italic; }
    .oc-quote cite { display:block; margin-top:.2rem; font-style:normal; font-size:.75rem; color:var(--cyan); font-weight:600; }
    @media (max-width:560px) {
      .oc-features { grid-template-columns:1fr; }
      .oc-quotes { grid-template-columns:1fr; }
    }
    /* ===== Admin Panel ===== */
    .admin-panel { margin-top:1rem; display:none; }
    .admin-panel.active { display:block; }
    body.admin-mode .user-section,
    body.admin-mode .top-book-btn,
    body.admin-mode .success-modal-overlay:not(#confirm-modal):not(#error-modal):not(#tax-category-modal),
    body.admin-mode footer { display:none !important; }
    body.admin-mode .admin-panel { margin-top:0; }
    .admin-lock { border:1px solid var(--line); border-radius:2px; padding:.75rem; background:#10121a; margin-top:.6rem; }
    .admin-controls { display:none; margin-top:.8rem; }
    .admin-controls.active { display:block; }
    .admin-collapsible-card { border:1px solid var(--line); border-radius:2px; padding:.55rem; background:#10121a; }
    .admin-collapsible-head { display:flex; align-items:center; justify-content:space-between; gap:.6rem; margin-bottom:.35rem; }
    .admin-collapsible-body-collapsed { display:none; }
    .admin-grid { display:grid; grid-template-columns:1fr 1fr; gap:.8rem; }
    .admin-list { max-height:320px; overflow:auto; border:1px solid var(--line); border-radius:2px; padding:.4rem; background:#10121a; font-size:.85rem; color:var(--muted); }
    .tax-row { display:grid; grid-template-columns:auto 1fr auto auto; gap:.45rem; align-items:center; padding:.38rem .35rem; border-bottom:1px dashed var(--line); }
    .tax-row:last-child { border-bottom:none; }
    .tax-row .type { font-size:.72rem; padding:.08rem .32rem; border:1px solid var(--line); border-radius:999px; color:var(--text); }
    .tax-row .desc { min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .tax-row .amt { color:var(--text); font-weight:700; }
    .tax-row .edit { padding:.2rem .5rem; font-size:.75rem; }
    .tax-row .delete { padding:.2rem .5rem; font-size:.75rem; border-color:#5a2222; color:#ff9b9b; }
    .btn.delete { border-color:#5a2222; color:#ff9b9b; }
    .btn.tx-filter-btn.active { background:linear-gradient(145deg,var(--cyan),#007ab5); border-color:var(--cyan); color:#000; }

    /* ===== Admin desktop layout overrides ===== */
    body.admin-mode .container { max-width:1440px; }
    body.admin-mode { font-size:1.08rem; }
    body.admin-mode label { font-size:1rem; }
    body.admin-mode h3 { font-size:1.25rem; }
    body.admin-mode h4 { font-size:1.05rem; }
    body.admin-mode .btn { padding:.75rem 1.2rem; font-size:1rem; }
    body.admin-mode .admin-grid { gap:1.2rem; }
    body.admin-mode .admin-collapsible-card { padding:.85rem; }
    body.admin-mode .admin-calendar-wrap { padding:1rem; }
    body.admin-mode .admin-list { max-height:520px; font-size:1rem; }
    body.admin-mode .tax-row { padding:.55rem .5rem; gap:.6rem; }
    body.admin-mode .tax-row .type { font-size:.85rem; padding:.1rem .4rem; }
    body.admin-mode .tax-row .edit,
    body.admin-mode .tax-row .delete { padding:.35rem .75rem; font-size:.95rem; }
    body.admin-mode .admin-calendar-title { font-size:1.05rem; }
    body.admin-mode .admin-cal-dow { font-size:.85rem; }
    body.admin-mode .admin-cal-day { min-height:58px; font-size:.85rem; }
    body.admin-mode .admin-cal-day-num { font-size:.85rem; }
    body.admin-mode .admin-legend { font-size:.92rem; }
    body.admin-mode .tax-summary-col h4 { font-size:1rem; }
    body.admin-mode .admin-calendar-head { margin-bottom:.8rem; }

    .admin-calendar-wrap { margin-top:.7rem; border:1px solid var(--line); border-radius:2px; background:#10121a; padding:.7rem; }
    /* ===== Tax Ledger ===== */
    .tax-summary-grid { display:grid; grid-template-columns:1fr 1fr; gap:.6rem; }
    .tax-summary-col { border:1px solid var(--line); border-radius:2px; padding:.6rem; background:#141620; }
    .tax-summary-col h4 { margin:.1rem 0 .45rem; color:var(--cyan); font-size:.9rem; }
    .tax-summary-line { display:flex; justify-content:space-between; gap:.6rem; padding:.12rem 0; color:var(--muted); }
    .tax-summary-line strong { color:var(--text); font-weight:700; }
    .tax-entry-wrap { margin-top:1rem; }
    .admin-calendar-head { display:flex; justify-content:space-between; align-items:center; margin-bottom:.5rem; gap:.45rem; }
    .admin-calendar-title { font-size:.9rem; color:var(--cyan); }
    .admin-calendar-grid { display:grid; grid-template-columns:repeat(7,minmax(0,1fr)); gap:.25rem; }
    .admin-cal-dow { font-size:.72rem; color:var(--muted); text-align:center; padding:.2rem 0; }
    .admin-cal-day { min-height:46px; border:1px solid var(--line); border-radius:2px; padding:.25rem; font-size:.72rem; color:var(--text); position:relative; background:#141620; }
    .admin-cal-day.empty { background:transparent; border-color:transparent; }
    .admin-cal-day-num { font-size:.72rem; }
    .admin-cal-dots { position:absolute; left:.25rem; right:.25rem; bottom:.25rem; display:flex; gap:.2rem; flex-wrap:wrap; }
    .admin-dot { width:7px; height:7px; border-radius:50%; }
    .admin-dot.booked-openclaw { background:#ff5555; }
    .admin-dot.booked-lessons { background:#c850ff; }
    .admin-dot.blocked { background:#ffaa2a; }
    .admin-legend { display:flex; gap:.7rem; align-items:center; margin-top:.5rem; color:var(--muted); font-size:.75rem; }
    .admin-legend span { display:inline-flex; align-items:center; gap:.3rem; }
    .faq-section { margin-top:1rem; display:grid; gap:0.7rem; }
    /* ===== FAQ ===== */
    .faq-item { background:var(--card); border:1px solid var(--line); border-radius:0; padding:0.85rem 1rem; }
    .faq-item h3 { margin:0 0 0.35rem; color:var(--cyan); font-size:0.98rem; }
    .faq-item p { margin:0; color:var(--muted); line-height:1.5; font-size:0.92rem; }
    /* ===== Header & Navigation ===== */
    .brand-header { display:flex; flex-direction:column; align-items:flex-start; gap:0.35rem; margin-bottom:0.6rem; }
    .brand-header img { width:170px; max-width:55vw; flex-shrink:0; display:block; object-fit:contain; border-radius:2px; }
    .brand-tagline {
      font-family:'Rajdhani', system-ui, sans-serif;
      font-weight:700;
      font-size:0.68rem;
      letter-spacing:0.22em;
      color:var(--muted);
      text-transform:uppercase;
    }
    .top-book-btn {
      position:fixed; top:1rem; right:1rem; z-index:300;
      text-decoration:none; font-weight:700; font-size:1.15rem;
      padding:0.75rem 1.6rem; border-radius:0;
      background:linear-gradient(145deg,#ff4fd8,#cc3fb0); border:1px solid #ff4fd8;
      color:#fff; box-shadow:0 0 22px rgba(255,79,216,0.45);
      text-transform:uppercase; letter-spacing:0.04em;
      font-family:'Titillium Web', system-ui, sans-serif;
    }
    .top-book-btn:hover { background:linear-gradient(145deg,#ff7ae4,#ff4fd8); box-shadow:0 0 28px rgba(255,79,216,0.6); }
    .book-pay-panel .top-book-btn { position:static; right:auto; top:auto; z-index:auto; display:block; text-align:center; }
    .back-btn {
      display:inline-flex; align-items:center; gap:0.35rem;
      text-decoration:none;
      font-family:'Titillium Web', system-ui, sans-serif;
      font-weight:600; font-size:0.82rem; letter-spacing:0.03em;
      color:var(--cyan);
      border:1px solid var(--cyan);
      border-radius:2px;
      padding:0.35rem 0.75rem;
      margin-bottom:0.8rem;
      background:rgba(0,229,255,0.06);
      transition:background 0.2s, box-shadow 0.2s, color 0.2s;
    }
    .back-btn:hover {
      background:rgba(0,229,255,0.14);
      box-shadow:0 0 14px rgba(0,229,255,0.3);
      color:#fff;
    }
    .back-btn svg {
      width:14px; height:14px; fill:currentColor; flex-shrink:0;
    }

    /* Session flow interactive layout */
    /* ===== Session Flow Interactive Layout ===== */
    .flow-grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; align-items:start; }
    .flow-steps { display:flex; flex-direction:column; gap:0; }
    .flow-step {
      padding:0.65rem 0.85rem;
      border-left:3px solid var(--line);
      cursor:pointer;
      transition:border-color 0.2s, background 0.2s;
    }
    .flow-step:hover { background:rgba(200,80,255,0.04); }
    .flow-step.active {
      border-left-color:var(--cyan);
      background:rgba(200,80,255,0.06);
    }
    .flow-step-title {
      font-family:'Titillium Web', system-ui, sans-serif;
      font-weight:600;
      font-size:0.95rem;
      color:var(--text);
    }
    .flow-step.active .flow-step-title { color:var(--cyan); }
    .flow-step-time {
      font-size:0.78rem;
      color:var(--muted);
      margin-top:0.15rem;
    }
    .flow-detail {
      background:#10121a;
      border:1px solid var(--line);
      border-radius:0;
      padding:1.2rem;
      position:sticky;
      top:1rem;
    }
    .flow-detail h3 {
      margin:0 0 0.5rem;
      color:var(--cyan);
      font-size:1.05rem;
    }
    .flow-detail p {
      margin:0;
      line-height:1.65;
      font-size:0.93rem;
    }

    @media (max-width: 820px) {
      .footer-inner { flex-direction: column; align-items: stretch; gap: 1.5rem; }
      .footer-newsletter { flex: none; width: 100%; }
    }

    /* ===== Responsive: 760px ===== */
    @media (max-width: 760px) {
      .booking-grid, .admin-grid { grid-template-columns:1fr; }
      .form-grid { grid-template-columns:1fr; }
      .tax-summary-grid { grid-template-columns:1fr; }
      .flow-grid { grid-template-columns:1fr; }

      /* Sticky bottom CTA bar for booking — no clip-path at full width */
      .top-book-btn {
        position:fixed; top:auto; bottom:env(safe-area-inset-bottom, 0px);
        left:0; right:0; width:100%;
        border-radius:0; text-align:center;
        font-size:1.1rem; padding:0.85rem 1rem;
        box-shadow:0 -4px 20px rgba(255,79,216,0.4);
        clip-path:none;
      }

      body { padding-bottom:80px; }

      .container { padding:0.8rem; }
      .card.user-section:first-of-type { padding-right: 1rem; }

      h1 { font-size:1.3rem; }
      h2 { font-size:1.1rem; }

      input, textarea, select { font-size:16px; }

      .book-pay-panel { background:transparent; border:none; padding:0; clip-path:none; }
      .booking-grid > div { padding-left:0; padding-right:0; }
      .btn-wide { font-size:1.05rem; padding:0.75rem; }

      .card { padding:0.8rem; }
      ul { padding-left:1.1rem; }
      li { margin-bottom:0.4rem; }

      .success-modal { padding:0.8rem; }

      .admin-cal-day { min-height:38px; }
      .admin-calendar-grid { gap:0.15rem; }
    }

    /* ===== Responsive: 480px ===== */
    @media (max-width: 480px) {
      h1 { font-size:1.15rem; }
      .brand-header img { width:135px; max-width:70vw; }
      .brand-tagline { font-size:0.58rem; letter-spacing:0.17em; }
      .card { padding:0.65rem; }
      .container { padding:0.6rem; }
    }
  </style>
  <!-- Brevo newsletter -->
  <style>
    @font-face { font-display:block; font-family:Roboto; src:url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/7529907e9eaf8ebb5220c5f9850e3811.woff2) format("woff2"),url(https://assets.brevo.com/font/Roboto/Latin/normal/normal/25c678feafdc175a70922a116c9be3e7.woff) format("woff") }
    @font-face { font-display:fallback; font-family:Roboto; font-weight:600; src:url(https://assets.brevo.com/font/Roboto/Latin/medium/normal/6e9caeeafb1f3491be3e32744bc30440.woff2) format("woff2"),url(https://assets.brevo.com/font/Roboto/Latin/medium/normal/71501f0d8d5aa95960f6475d5487d4c2.woff) format("woff") }
    @font-face { font-display:fallback; font-family:Roboto; font-weight:700; src:url(https://assets.brevo.com/font/Roboto/Latin/bold/normal/3ef7cf158f310cf752d5ad08cd0e7e60.woff2) format("woff2"),url(https://assets.brevo.com/font/Roboto/Latin/bold/normal/ece3a1d82f18b60bcce0211725c476aa.woff) format("woff") }
    #sib-container input:-ms-input-placeholder { text-align:left; font-family:'Titillium Web',sans-serif; color:#555870; }
    #sib-container input::placeholder { text-align:left; font-family:'Titillium Web',sans-serif; color:#555870; }
    #sib-container a { text-decoration:underline; color:#00e5ff; }
    #sib-container.sib-container--large { padding: 0.7rem !important; }
  </style>
  <link rel="stylesheet" href="https://sibforms.com/forms/end-form/build/sib-styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <!-- ===== SECTION: Page Header & Navigation ===== -->
  <main>
  <div class="container">

    <!-- ===== SECTION: Booking Form ===== -->
    <section id="pick-setup" class="card user-section" style="margin-top:1rem; margin-bottom:1rem;">
      <nav aria-label="Site navigation">
        <a href="/" class="back-btn"><svg viewBox="0 0 16 16" aria-hidden="true"><path d="M10.354 3.354a.5.5 0 0 0-.708-.708l-5 5a.5.5 0 0 0 0 .708l5 5a.5.5 0 0 0 .708-.708L5.707 8l4.647-4.646z"/></svg>Home</a>
        <a href="#" id="openclaw-info-link" style="font-size:.82rem; color:var(--cyan); text-shadow:none; text-decoration:underline; margin-left:.6rem;">What is OpenClaw?</a>
      </nav>
      <h1>OpenClaw Setup in Eastern Shore Maryland</h1>
      <h2>Pick Your Setup Day</h2>
      <div class="booking-grid" style="grid-template-columns:1fr;">
        <aside class="book-pay-panel">
          <h3 style="margin:.1rem 0 .2rem;">Reserve Your Spot</h3>
          <p>Choose your date and time, fill in your details, then hit Book + Pay Now.</p>
          <p style="margin:.3rem 0 .5rem; font-size:0.95rem;"><strong style="color:var(--text);">Cost:</strong> $100 + MD state taxes</p>
          <div class="form-grid" style="margin-top:.4rem;">
            <div>
              <label for="setup-date">Preferred Setup Date</label>
              <input id="setup-date" type="date" />
            </div>
            <div>
              <label for="setup-time">Preferred Time Block</label>
              <select id="setup-time">
                <option value="">Select time block…</option>
              </select>
            </div>
            <div>
              <label for="book-name">Your Name</label>
              <input id="book-name" required />
            </div>
            <div>
              <label for="book-email">Your Email</label>
              <input id="book-email" type="email" required />
            </div>
            <div>
              <label for="book-phone">Phone Number (optional)</label>
              <input id="book-phone" type="tel" placeholder="(555) 123-4567" />
            </div>
            <div>
              <label for="book-preferred-contact-method">Preferred Contact Method</label>
              <select id="book-preferred-contact-method" required>
                <option value="email">Email</option>
                <option value="phone">Phone</option>
              </select>
            </div>
          </div>
          <div class="full"><button type="button" class="top-book-btn" id="book-pay-btn" style="margin-top:.6rem; width:100%;">Book + Pay Now</button></div>
        </aside>
      </div>
    </section>

    <!-- ===== SECTION: Session Flow / What to Expect ===== -->
    <section class="card user-section">
      <h2>What You Should Expect</h2>
      <p>Sessions are blocked off for ~two hours, but setup can take less time depending on which features you're looking for. Here's how a typical session flows:</p>
      <div class="flow-grid">
        <div class="flow-steps" id="flow-steps">
          <div class="flow-step active" data-flow="0">
            <div class="flow-step-title">Intro and Assessment</div>
            <div class="flow-step-time">~10 min</div>
          </div>
          <div class="flow-step" data-flow="1">
            <div class="flow-step-title">Agent Install</div>
            <div class="flow-step-time">~15 min</div>
          </div>
          <div class="flow-step" data-flow="2">
            <div class="flow-step-title">Security Audit &amp; Hardening</div>
            <div class="flow-step-time">~15–30 min</div>
          </div>
          <div class="flow-step" data-flow="3">
            <div class="flow-step-title">Feature Orientation</div>
            <div class="flow-step-time">~10 min</div>
          </div>
          <div class="flow-step" data-flow="4">
            <div class="flow-step-title">Skills &amp; Tooling</div>
            <div class="flow-step-time">~15 min</div>
          </div>
          <div class="flow-step" data-flow="5">
            <div class="flow-step-title">Dashboard &amp; Customization</div>
            <div class="flow-step-time">~10 min</div>
          </div>
          <div class="flow-step" data-flow="6">
            <div class="flow-step-title">Troubleshooting Walkthrough</div>
            <div class="flow-step-time">~15 min</div>
          </div>
          <div class="flow-step" data-flow="7">
            <div class="flow-step-title">Questions</div>
            <div class="flow-step-time">Open-ended</div>
          </div>
          <div class="flow-step" data-flow="8">
            <div class="flow-step-title">30 Days of Follow-Up Support</div>
            <div class="flow-step-time">Post-session</div>
          </div>
        </div>
        <div class="flow-detail" id="flow-detail">
          <h3 id="flow-detail-title">Intro and Assessment</h3>
          <p id="flow-detail-desc">We'll chat and see what you're looking to accomplish and what your technical background is to see how to optimize setup and daily operation for maximum effectiveness.</p>
        </div>
      </div>
    </section>

    <!-- ===== SECTION: FAQ & Contact Form ===== -->
    <section class="card user-section" style="margin-top:1rem;">
      <h2>Questions Before Your Setup?</h2>
      <form id="setup-page-form">
        <div class="form-grid">
          <div>
            <label for="name">Your Name</label>
            <input id="name" required />
          </div>
          <div>
            <label for="email">Your Email</label>
            <input id="email" type="email" required />
          </div>
          <div>
            <label for="phone">Phone Number (optional)</label>
            <input id="phone" type="tel" placeholder="(555) 123-4567" />
          </div>
          <div>
            <label for="preferred-contact-method">Preferred Contact Method</label>
            <select id="preferred-contact-method" required>
              <option value="email">Email</option>
              <option value="phone">Phone</option>
            </select>
          </div>
          <div class="full">
            <label for="message">Questions</label>
            <textarea id="message" required placeholder="Share any questions before your setup session."></textarea>
          </div>
        </div>
        <div class="form-actions"><button class="btn btn-primary" type="submit">Send Questions</button></div>
        <p class="form-status" id="status"></p>
      </form>
    </section>

    <!-- ===== SECTION: Admin Panel (hidden, ?admin=1) ===== -->
    <section class="card admin-panel" id="admin-panel" style="padding:0; overflow:hidden;">
      <img src="/carousel.png" alt="" aria-hidden="true" style="width:100%; aspect-ratio:32/5; object-fit:cover; object-position:center top; display:block;" />
      <div style="padding:1.5rem 2rem 0;">
        <h2 style="margin:0 0 0.25rem;">Eastern Shore AI</h2>
        <p style="margin:0 0 1rem; color:var(--muted); font-size:0.9rem; letter-spacing:.06em; text-transform:uppercase;">Administrative Access</p>
      </div>
      <div class="admin-lock" id="admin-lock" style="padding:1rem 1rem 2.5rem; margin:0 1rem;">
        <div style="display:flex; flex-direction:column; gap:1rem; width:320px; margin:0 auto;">
          <label for="admin-key" style="font-size:1.1rem; color:var(--cyan); letter-spacing:.08em; text-align:center;">Admin Password</label>
          <input id="admin-key" type="password" placeholder="Enter admin password" style="font-size:1rem; padding:.6rem .9rem;" />
          <button type="button" class="btn btn-primary" id="admin-unlock-btn" style="font-size:1.15rem; padding:.85rem 2rem; letter-spacing:.06em;">Login</button>
        </div>
      </div>

      <div class="admin-controls" id="admin-controls" style="padding:0 1rem 1rem;">
        <div class="admin-collapsible-card" id="booking-controls-card">
          <div class="admin-collapsible-head">
            <h3 style="margin:0;">Admin Booking Controls</h3>
            <button type="button" class="btn" id="booking-collapse-btn" aria-expanded="false">Expand</button>
          </div>
          <div id="booking-controls-body" class="admin-collapsible-body-collapsed">
        <div class="admin-grid" style="margin-top:.7rem;">
          <div>
            <h3 style="margin:.1rem 0 .4rem;">Block / Unblock Slot</h3>
            <div class="form-grid" style="margin-top:0;">
              <div>
                <label for="admin-date">Date</label>
                <input id="admin-date" type="date" />
              </div>
              <div>
                <label for="admin-time">Time Block</label>
                <select id="admin-time">
                  <option value="">Select block…</option>
                </select>
              </div>
              <div class="full">
                <label for="admin-reason">Reason (optional)</label>
                <input id="admin-reason" placeholder="Unavailable / booked elsewhere" />
              </div>
            </div>
            <div class="form-actions" style="justify-content:flex-start; gap:.5rem; flex-wrap:wrap;">
              <button type="button" class="btn btn-primary" id="admin-block-btn">Block Slot</button>
              <button type="button" class="btn" id="admin-unblock-btn">Unblock Slot</button>
              <button type="button" class="btn btn-primary" id="admin-block-day-btn">Block Entire Day</button>
              <button type="button" class="btn" id="admin-unblock-day-btn">Unblock Day</button>
              <button type="button" class="btn" id="admin-refresh-btn">Refresh</button>
            </div>
          </div>
          <div>
            <h3 style="margin:.1rem 0 .4rem;">Recent Bookings / Blocks</h3>
            <div class="admin-list" id="admin-list">No data yet.</div>
            <div class="admin-calendar-wrap">
              <div class="admin-calendar-head">
                <button type="button" class="btn" id="admin-cal-prev-btn">← Prev</button>
                <div class="admin-calendar-title" id="admin-calendar-title">Availability Calendar</div>
                <button type="button" class="btn" id="admin-cal-next-btn">Next →</button>
              </div>
              <div class="admin-calendar-grid" id="admin-calendar-grid"></div>
              <div class="admin-legend">
                <span><i class="admin-dot booked-openclaw"></i>OpenClaw</span>
                <span><i class="admin-dot booked-lessons"></i>Lessons</span>
                <span><i class="admin-dot blocked"></i>Blocked</span>
              </div>
            </div>
          </div>

        </div>
          </div>
        </div>

        <div class="admin-collapsible-card" id="tax-ledger-card" style="margin-top:1rem;">
          <div class="admin-collapsible-head">
            <h3 style="margin:0;">Tax Ledger</h3>
            <button type="button" class="btn" id="tax-collapse-btn" aria-expanded="false">Expand</button>
          </div>
          <div id="tax-ledger-body" class="admin-collapsible-body-collapsed">
        <!-- ===== SECTION: Admin Tax Ledger ===== -->
        <section class="admin-calendar-wrap" style="margin-top:.5rem; grid-column:1 / -1;">
          <div class="admin-grid" style="grid-template-columns:1fr; gap:.6rem;">
                <div id="tax-summary" class="admin-calendar-wrap" style="margin:0;">
                  <div class="admin-calendar-head"><div class="admin-calendar-title">Year Totals Snapshot</div></div>
                  <div class="tax-summary-grid" id="tax-summary-list">No data yet.</div>
                </div>

                <div class="admin-row" style="gap:.5rem; flex-wrap:wrap;">
                  <label style="min-width:80px;">Year</label>
                  <select id="tax-year" style="max-width:160px;"></select>
                  <label style="min-width:70px;">Type</label>
                  <select id="tax-type" style="max-width:200px;">
                    <option value="all">All</option>
                    <option value="income">Income</option>
                    <option value="expense">Expenses</option>
                  </select>
                  <button type="button" class="btn" id="tax-refresh-btn">Refresh</button>
                  <button type="button" class="btn btn-primary" id="tax-export-btn">Download CSV</button>
                  <button type="button" class="btn" id="tax-zip-btn">⬇ Year Package (.zip)</button>
                </div>

                <div class="admin-row" style="gap:.4rem; flex-wrap:wrap; margin-top:.4rem;">
                  <button type="button" class="btn btn-primary tx-entry-mode-btn" id="tax-mode-expense-btn">Add Expense</button>
                  <button type="button" class="btn btn-primary tx-entry-mode-btn" id="tax-mode-income-btn">Add Income</button>
                  <button type="button" class="btn btn-primary" id="tax-manage-categories-btn" onclick="window.openTaxCategoryManager && window.openTaxCategoryManager()">Manage Categories</button>
                </div>

                <div class="tax-entry-wrap" id="tax-expense-panel" style="margin-top:.5rem; display:none;">
                  <div class="admin-calendar-wrap">
                    <div class="admin-calendar-head" style="display:flex; justify-content:space-between; align-items:center;"><div class="admin-calendar-title">Add Expense</div><button type="button" class="btn" id="tax-minimize-expense-btn">Minimize</button></div>
                    <div class="admin-row" id="tax-expense-fields" style="flex-direction:column; align-items:stretch;">
                      <label>Date</label>
                      <input id="tax-expense-date" type="date" />
                      <label>Vendor</label>
                      <input id="tax-expense-vendor" placeholder="e.g. Amazon, Cloudflare" />
                      <label>Category</label>
                      <select id="tax-expense-category"></select>
                      <label>Amount (USD)</label>
                      <input id="tax-expense-amount" type="number" step="0.01" placeholder="0.00" />
                      <label>Paid via</label>
                      <input id="tax-expense-paidvia" placeholder="card, cash, bank, etc." />
                      <label>Notes</label>
                      <input id="tax-expense-notes" placeholder="optional" />
                      <label>Receipt <span style="font-size:0.78rem; color:var(--muted); font-weight:400;">(optional — PDF, JPG, PNG)</span></label>
                      <div style="display:flex; align-items:center; gap:0.6rem; flex-wrap:wrap;">
                        <label for="tax-expense-receipt" class="btn" style="cursor:pointer; white-space:nowrap; margin:0;">Browse…</label>
                        <input id="tax-expense-receipt" type="file" accept=".pdf,.jpg,.jpeg,.png" style="display:none;" />
                        <span id="tax-expense-receipt-name" style="font-size:0.8rem; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">No file chosen</span>
                      </div>
                      <div class="form-actions" style="justify-content:flex-start; gap:.5rem; flex-wrap:wrap;">
                        <button type="button" class="btn btn-primary" id="tax-add-expense-btn">Add Expense</button>
                        <button type="button" class="btn btn-primary" id="tax-update-expense-btn" style="display:none;">Save Expense Update</button>
                        <button type="button" class="btn" id="tax-cancel-expense-edit-btn" style="display:none;">Cancel Edit</button>
                        <button type="button" class="btn" id="tax-clear-expense-btn">Clear</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="tax-entry-wrap" id="tax-income-panel" style="margin-top:.5rem; display:none;">
                  <div class="admin-calendar-wrap">
                    <div class="admin-calendar-head" style="display:flex; justify-content:space-between; align-items:center;"><div class="admin-calendar-title">Add Income</div><button type="button" class="btn" id="tax-minimize-income-btn">Minimize</button></div>
                    <div class="admin-row" id="tax-income-fields" style="flex-direction:column; align-items:stretch;">
                      <label>Date</label>
                      <input id="tax-income-date" type="date" />
                      <label>Source</label>
                      <input id="tax-income-source" placeholder="e.g. Stripe, Client" />
                      <label>Category</label>
                      <select id="tax-income-category"></select>
                      <label>Amount (USD)</label>
                      <input id="tax-income-amount" type="number" step="0.01" placeholder="0.00" />
                      <label>Stripe session id (optional)</label>
                      <input id="tax-income-stripe" placeholder="cs_test_..." />
                      <label>Notes</label>
                      <input id="tax-income-notes" placeholder="optional" />
                      <label>Receipt <span style="font-size:0.78rem; color:var(--muted); font-weight:400;">(optional — PDF, JPG, PNG)</span></label>
                      <div style="display:flex; align-items:center; gap:0.6rem; flex-wrap:wrap;">
                        <label for="tax-income-receipt" class="btn" style="cursor:pointer; white-space:nowrap; margin:0;">Browse…</label>
                        <input id="tax-income-receipt" type="file" accept=".pdf,.jpg,.jpeg,.png" style="display:none;" />
                        <span id="tax-income-receipt-name" style="font-size:0.8rem; color:var(--muted); overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">No file chosen</span>
                      </div>
                      <div class="form-actions" style="justify-content:flex-start; gap:.5rem; flex-wrap:wrap;">
                        <button type="button" class="btn btn-primary" id="tax-add-income-btn" style="padding:.85rem 1.35rem; font-size:1.05rem;">Add Income</button>
                        <button type="button" class="btn btn-primary" id="tax-update-income-btn" style="display:none;">Save Income Update</button>
                        <button type="button" class="btn" id="tax-cancel-income-edit-btn" style="display:none;">Cancel Edit</button>
                        <button type="button" class="btn" id="tax-clear-income-btn" style="padding:.85rem 1.35rem; font-size:1.05rem;">Clear</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div>
                  <div style="display:flex; align-items:center; flex-wrap:wrap; gap:.5rem; margin:.1rem 0 .4rem;">
                    <h3 style="margin:0; white-space:nowrap;">Tax Transactions (Selected Year)</h3>
                    <div style="display:flex; gap:.3rem; flex-wrap:wrap;">
                      <button type="button" class="btn tx-filter-btn active" data-filter="all">All</button>
                      <button type="button" class="btn tx-filter-btn" data-filter="income">Income</button>
                      <button type="button" class="btn tx-filter-btn" data-filter="expense">Expenses</button>
                    </div>
                    <select id="tx-category-filter" style="display:none; max-width:200px;"></select>
                  </div>
                  <div class="admin-list" id="tax-list">No data yet.</div>
                </div>
              </div>
        </section>

        </div>
      </div>
    </section>

    <!-- ===== SECTION: Footer ===== -->
    <footer>
      <div class="footer-inner">
        <div class="footer-newsletter">
          <div class="sib-form" style="text-align:left; background-color:transparent; padding:0;">
            <div id="sib-form-container" class="sib-form-container">
              <div id="error-message" class="sib-form-message-panel" style="font-size:13px; text-align:left; font-family:'Titillium Web',sans-serif; color:#ff8080; background-color:#1a0808; border-radius:2px; border-color:#ff4949; max-width:100%;">
                <div class="sib-form-message-panel__text sib-form-message-panel__text--center">
                  <svg viewBox="0 0 512 512" class="sib-icon sib-notification__icon"><path d="M256 40c118.621 0 216 96.075 216 216 0 119.291-96.61 216-216 216-119.244 0-216-96.562-216-216 0-119.203 96.602-216 216-216m0-32C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm-11.49 120h22.979c6.823 0 12.274 5.682 11.99 12.5l-7 168c-.268 6.428-5.556 11.5-11.99 11.5h-8.979c-6.433 0-11.722-5.073-11.99-11.5l-7-168c-.283-6.818 5.167-12.5 11.99-12.5zM256 340c-15.464 0-28 12.536-28 28s12.536 28 28 28 28-12.536 28-28-12.536-28-28-28z"/></svg>
                  <span class="sib-form-message-panel__inner-text">Your subscription could not be saved. Please try again.</span>
                </div>
              </div>
              <div></div>
              <div id="success-message" class="sib-form-message-panel" style="font-size:13px; text-align:left; font-family:'Titillium Web',sans-serif; color:#00e5ff; background-color:#061414; border-radius:2px; border-color:#00c8d4; max-width:100%;">
                <div class="sib-form-message-panel__text sib-form-message-panel__text--center">
                  <svg viewBox="0 0 512 512" class="sib-icon sib-notification__icon"><path d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 464c-118.664 0-216-96.055-216-216 0-118.663 96.055-216 216-216 118.664 0 216 96.055 216 216 0 118.663-96.055 216-216 216zm141.63-274.961L217.15 376.071c-4.705 4.667-12.303 4.637-16.97-.068l-85.878-86.572c-4.667-4.705-4.637-12.303.068-16.97l8.52-8.451c4.705-4.667 12.303-4.637 16.97.068l68.976 69.533 163.441-162.13c4.705-4.667 12.303-4.637 16.97.068l8.451 8.52c4.668 4.705 4.637 12.303-.068 16.97z"/></svg>
                  <span class="sib-form-message-panel__inner-text">Your subscription to the Eastern Shore AI newsletter was successful.</span>
                </div>
              </div>
              <div></div>
              <div id="sib-container" class="sib-container--large sib-container--vertical" style="text-align:left; background-color:#141620; max-width:100%; border-radius:2px; border-width:1px; border-color:#222438; border-style:solid; direction:ltr">
                <form id="sib-form" method="POST" action="https://b893ca94.sibforms.com/serve/MUIFAFHNpDgPU-nDfEV3TZttituEiSyIy4p0twQYehCWbO2QZjGgiYIf52Tzi8BjJZHKZaEdmpJZ8wZjawIvJ54EGnqgFvTS-rjUbDTxDA5ftlMluW-n-7ML1FaJ098ByQDvenhzBTDbOJfcfDg1fBs0YLFY3Jvggh62UAvuUmlC3dv5iF1pqPDzqeODqH3UpQhEaJF7yQfUR4bGrA==" data-type="subscription">
                  <div style="padding:3px 0;">
                    <div class="sib-form-block" style="font-size:0.85rem; font-weight:700; font-family:'Hanken Grotesk',sans-serif; color:#00e5ff; background-color:transparent; letter-spacing:0.08em; text-transform:uppercase; text-align:left;"><p>OUR NEWSLETTER</p></div>
                  </div>
                  <div style="padding:3px 0;">
                    <div class="sib-form-block" style="font-size:12px; font-family:'Titillium Web',sans-serif; color:#7a7e96; background-color:transparent; text-align:left;"><p>Subscribe and stay updated.</p></div>
                  </div>
                  <div style="padding:4px 0 0;">
                    <div class="sib-input sib-form-block">
                      <div class="form__entry entry_block">
                        <div style="display:flex; gap:0.4rem; align-items:center;">
                          <div class="entry__field" style="flex:1; min-width:0; display:flex; align-items:center;">
                            <input class="input" type="text" id="EMAIL" name="EMAIL" autocomplete="off" placeholder="your@email.com" data-required="true" required style="background:#0a0b10; border:1px solid #222438; border-radius:2px; color:#d8dce8; font-family:'Titillium Web',sans-serif; font-size:18px; width:100%; height:2.4rem; box-sizing:border-box;" />
                          </div>
                          <button class="sib-form-block__button sib-form-block__button-with-loader" style="flex-shrink:0; font-size:0.9rem; font-weight:700; font-family:'Hanken Grotesk',sans-serif; color:#fff; background:linear-gradient(145deg,#ff4fd8,#c850ff); box-shadow:0 0 12px rgba(255,79,216,0.6); border-radius:2px; border-width:0; letter-spacing:0.07em; padding:0 1.4rem; height:2.4rem; box-sizing:border-box; cursor:pointer; white-space:nowrap;" form="sib-form" type="submit">
                            <svg class="icon clickable__icon progress-indicator__icon sib-hide-loader-icon" viewBox="0 0 512 512"><path d="M460.116 373.846l-20.823-12.022c-5.541-3.199-7.54-10.159-4.663-15.874 30.137-59.886 28.343-131.652-5.386-189.946-33.641-58.394-94.896-95.833-161.827-99.676C261.028 55.961 256 50.751 256 44.352V20.309c0-6.904 5.808-12.337 12.703-11.982 83.556 4.306 160.163 50.864 202.11 123.677 42.063 72.696 44.079 162.316 6.031 236.832-3.14 6.148-10.75 8.461-16.728 5.01z"/></svg>
                            SUBSCRIBE
                          </button>
                        </div>
                        <label class="entry__error entry__error--primary" style="font-size:12px; font-family:'Titillium Web',sans-serif; color:#ff8080; background-color:#1a0808; border-radius:2px; border-color:#ff4949;"></label>
                      </div>
                    </div>
                  </div>
                  <input type="text" name="email_address_check" value="" class="input--hidden">
                  <input type="hidden" name="locale" value="en">
                </form>
              </div>
            </div>
          </div>
        </div>
        <div class="footer-info">
          © <span id="year"></span> Eastern Shore AI, LLC &nbsp;·&nbsp; <a href="tel:+14106928562" class="footer-link">(410) 692-8562</a> &nbsp;·&nbsp; <a href="https://x.com/easternshoreAI" target="_blank" rel="noopener noreferrer" class="footer-link">X / Twitter</a> &nbsp;·&nbsp; <a href="https://instagram.com/easternshoreai" target="_blank" rel="noopener noreferrer" class="footer-link">Instagram</a> &nbsp;·&nbsp; <a href="https://discord.gg/w8PZMXKN2N" target="_blank" rel="noopener noreferrer" class="footer-link">Discord</a><br>
          <a href="#" class="footer-link" id="contact-link">Contact Us</a>
          <a href="#" class="footer-link" id="about-link">About Us</a>
          <a href="#" class="footer-link" id="terms-link">Terms of Use</a>
          <a href="#" class="footer-link" id="privacy-link">Privacy Policy</a>
        </div>
      </div>
    </footer>
  </div>
  </main>

  <!-- ===== SECTION: Modal Overlays ===== -->
  <div class="success-modal-overlay" id="about-modal" aria-hidden="true">
    <div class="success-modal" role="dialog" aria-modal="true" aria-labelledby="about-title">
      <h3 id="about-title">About Us</h3>
      <p><strong>Eastern Shore AI, LLC</strong> builds practical AI-powered tools and small business websites, with a focus on fast shipping and clean UX.</p>
      <p>Founded in February 2026 by Chris Gorham, a resident of Fruitland, MD and retired Navy veteran.</p>
      <div class="simple-modal-links">
        <a class="footer-link" href="https://x.com/easternshoreai" target="_blank" rel="noopener noreferrer">Twitter / X</a>
        <a class="footer-link" href="https://github.com/99redder" target="_blank" rel="noopener noreferrer">GitHub</a>
      </div>
      <div class="simple-modal-actions">
        <button type="button" class="btn btn-primary" id="about-close-btn">Close</button>
      </div>
    </div>
  </div>

  <div class="success-modal-overlay" id="contact-modal" aria-hidden="true">
    <div class="success-modal" role="dialog" aria-modal="true" aria-labelledby="contact-title">
      <h3 id="contact-title">Contact Us</h3>
      <p>Use the form on this page and we’ll get back to you within 24 hours.</p>
      <div class="simple-modal-actions">
        <button type="button" class="btn" id="contact-go-btn">Go to Contact Form</button>
        <button type="button" class="btn btn-primary" id="contact-close-btn">Close</button>
      </div>
    </div>
  </div>

  <div class="success-modal-overlay" id="terms-modal" aria-hidden="true">
    <div class="success-modal" role="dialog" aria-modal="true" aria-labelledby="terms-title">
      <h3 id="terms-title">Terms of Use</h3>
      <p>By using this website, you agree to use it lawfully and responsibly. Content is provided for general informational purposes and may change without notice.</p>
      <p>Service timelines, outcomes, and availability depend on scope and cooperation. Custom engagement terms, pricing, and deliverables are confirmed in writing before work begins.</p>
      <p>To the fullest extent allowed by law, Eastern Shore AI, LLC is not liable for indirect, incidental, or consequential damages from use of this site or related services.</p>
      <p>Contact: <a href="mailto:contact@easternshore.ai">contact@easternshore.ai</a></p>
      <div class="simple-modal-actions">
        <button type="button" class="btn btn-primary" id="terms-close-btn">Close</button>
      </div>
    </div>
  </div>

  <div class="success-modal-overlay" id="privacy-modal" aria-hidden="true">
    <div class="success-modal" role="dialog" aria-modal="true" aria-labelledby="privacy-title">
      <h3 id="privacy-title">Privacy Policy</h3>
      <p>We collect only information you voluntarily submit through forms (such as name, email, and message details) to respond to inquiries and provide requested services.</p>
      <p>Submitted information is used for communication and project follow-up. We do not sell personal data. Trusted service providers may process form delivery and email notifications.</p>
      <p>If you want submitted information corrected or deleted, contact us and we’ll handle it promptly, subject to legal or operational retention requirements.</p>
      <p>Contact: <a href="mailto:contact@easternshore.ai">contact@easternshore.ai</a></p>
      <div class="simple-modal-actions">
        <button type="button" class="btn btn-primary" id="privacy-close-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- ===== SECTION: OpenClaw Info Modal ===== -->
  <div class="success-modal-overlay" id="openclaw-info-modal" aria-hidden="true">
    <div class="success-modal" role="dialog" aria-modal="true" aria-labelledby="oc-info-title">
      <h3 id="oc-info-title" style="color:var(--cyan); margin:.1rem 0 .3rem;">What is OpenClaw?</h3>
      <p class="oc-tagline">"The AI that actually does things."</p>
      <p class="oc-sub">OpenClaw is a personal AI assistant that clears your inbox, sends emails, manages your calendar, and checks you in for flights — all through WhatsApp, Telegram, Discord, Slack, Signal, iMessage, or any chat app you already use. It runs locally on your machine, keeping your data private.</p>

      <div class="oc-features">
        <div class="oc-feature">
          <p class="oc-feature-title">🖥️ Runs on Your Machine</p>
          <p class="oc-feature-desc">Installs on Mac, Windows, or Linux. Your data stays local — no cloud lock-in.</p>
        </div>
        <div class="oc-feature">
          <p class="oc-feature-title">💬 Any Chat App</p>
          <p class="oc-feature-desc">Control it from WhatsApp, Telegram, Discord, Slack, Signal, or iMessage — wherever you already are.</p>
        </div>
        <div class="oc-feature">
          <p class="oc-feature-title">🧠 Persistent Memory</p>
          <p class="oc-feature-desc">Learns your preferences and remembers context across conversations.</p>
        </div>
        <div class="oc-feature">
          <p class="oc-feature-title">🌐 Browser Control</p>
          <p class="oc-feature-desc">Navigates websites, fills forms, and executes multi-step web tasks autonomously.</p>
        </div>
        <div class="oc-feature">
          <p class="oc-feature-title">⚙️ Full System Access</p>
          <p class="oc-feature-desc">Access files, run shell commands, execute scripts — full computer control via chat.</p>
        </div>
        <div class="oc-feature">
          <p class="oc-feature-title">🔌 Skills &amp; Plugins</p>
          <p class="oc-feature-desc">50+ integrations built-in, plus a skills marketplace (ClawHub). Self-extending via conversation.</p>
        </div>
      </div>

      <div class="oc-integrations">
        <p class="oc-integrations-label">Works with</p>
        <div class="oc-chips">
          <span class="oc-chip">WhatsApp</span><span class="oc-chip">Telegram</span><span class="oc-chip">Discord</span><span class="oc-chip">Slack</span><span class="oc-chip">Signal</span><span class="oc-chip">iMessage</span><span class="oc-chip">Gmail</span><span class="oc-chip">GitHub</span><span class="oc-chip">Spotify</span><span class="oc-chip">Twitter / X</span><span class="oc-chip">Browser</span><span class="oc-chip">Obsidian</span><span class="oc-chip">Hue</span><span class="oc-chip">Claude</span><span class="oc-chip">GPT</span><span class="oc-chip">50+ more</span>
        </div>
      </div>

      <div class="oc-quotes">
        <div class="oc-quote">"It's running my company."<cite>@therno</cite></div>
        <div class="oc-quote">"OpenClaw is Jarvis. It already exists."<cite>@nofil_ai</cite></div>
        <div class="oc-quote">"This is nuts. OpenClaw is a superpower."<cite>@robmartinson</cite></div>
        <div class="oc-quote">"Feels like we're living in the future."<cite>@Philo01</cite></div>
      </div>

      <div class="simple-modal-actions" style="justify-content:space-between; align-items:center; flex-wrap:wrap; gap:.5rem;">
        <a href="https://www.openclaw.ai" target="_blank" rel="noopener noreferrer" class="footer-link" style="margin:0;">Visit openclaw.ai →</a>
        <button type="button" class="btn btn-primary" id="openclaw-info-close-btn">Close</button>
      </div>
    </div>
  </div>

  <!-- ===== SECTION: Success Modal (post-payment) ===== -->
  <div class="success-modal-overlay" id="success-modal" aria-hidden="true">
    <div class="success-modal" role="dialog" aria-modal="true" aria-labelledby="success-title">
      <h3 id="success-title">Payment Received — Setup Booked ✅</h3>
      <p id="success-details">Your OpenClaw setup appointment is confirmed.</p>
      <div class="form-actions" style="margin-top:1rem;">
        <button type="button" class="btn btn-primary" id="success-close-btn">Got it</button>
      </div>
    </div>
  </div>

  <div class="success-modal-overlay" id="error-modal" aria-hidden="true">
    <div class="success-modal error-modal" role="dialog" aria-modal="true" aria-labelledby="error-title">
      <h3 id="error-title">Heads Up</h3>
      <p id="error-details"></p>
      <div class="form-actions" style="margin-top:1rem;">
        <button type="button" class="btn btn-primary" id="error-close-btn">OK</button>
      </div>
    </div>
  </div>

  <div class="success-modal-overlay" id="confirm-modal" aria-hidden="true">
    <div class="success-modal" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
      <h3 id="confirm-title">Please Confirm</h3>
      <p id="confirm-details"></p>
      <div class="form-actions" style="margin-top:1rem; display:flex; gap:.5rem; justify-content:flex-end;">
        <button type="button" class="btn" id="confirm-cancel-btn">Cancel</button>
        <button type="button" class="btn btn-primary" id="confirm-ok-btn">Confirm</button>
      </div>
    </div>
  </div>

  <div class="success-modal-overlay" id="tax-category-modal" aria-hidden="true">
    <div class="success-modal" role="dialog" aria-modal="true" aria-labelledby="tax-category-title" style="width:min(920px,94vw); max-height:86vh; overflow-y:auto;">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:.5rem;">
        <h3 id="tax-category-title" style="margin:.1rem 0 .4rem;">Manage Categories</h3>
        <button type="button" class="btn" id="tax-category-x-btn" aria-label="Close category manager" title="Close">✕</button>
      </div>
      <div class="admin-grid" style="grid-template-columns:1fr 1fr; gap:.7rem;">
        <div class="admin-calendar-wrap">
          <div class="admin-calendar-head"><div class="admin-calendar-title">Expense Categories</div></div>
          <div id="expense-categories-list" style="display:flex; flex-direction:column; gap:.35rem; margin-top:.5rem;"></div>
          <div style="margin-top:1.25rem; padding-top:.75rem; border-top:1px solid var(--line);">
            <label style="display:block; margin-bottom:.35rem;">Add New Category</label>
            <div class="admin-row" style="gap:.4rem;">
              <input id="new-expense-category" placeholder="Enter your new expense category, here" />
              <button type="button" class="btn btn-primary" id="add-expense-category-btn" style="min-width:120px;">Add</button>
            </div>
          </div>
        </div>
        <div class="admin-calendar-wrap">
          <div class="admin-calendar-head"><div class="admin-calendar-title">Income Categories</div></div>
          <div id="income-categories-list" style="display:flex; flex-direction:column; gap:.35rem; margin-top:.5rem;"></div>
          <div style="margin-top:1.25rem; padding-top:.75rem; border-top:1px solid var(--line);">
            <label style="display:block; margin-bottom:.35rem;">Add New Category</label>
            <div class="admin-row" style="gap:.4rem;">
              <input id="new-income-category" placeholder="Enter your new income category, here" />
              <button type="button" class="btn btn-primary" id="add-income-category-btn" style="min-width:120px;">Add</button>
            </div>
          </div>
        </div>
      </div>
      <div class="form-actions" style="margin-top:1rem; justify-content:flex-end;">
        <button type="button" class="btn" id="tax-category-close-btn">Close</button>
      </div>
    </div>
  </div>

  <div class="success-modal-overlay" id="tax-category-edit-modal" aria-hidden="true">
    <div class="success-modal" role="dialog" aria-modal="true" aria-labelledby="tax-category-edit-title" style="width:min(540px,94vw);">
      <h3 id="tax-category-edit-title">Edit Category</h3>
      <label for="tax-category-edit-input">Category Name</label>
      <input id="tax-category-edit-input" type="text" />
      <div class="form-actions" style="margin-top:1rem; justify-content:flex-end; gap:.5rem;">
        <button type="button" class="btn" id="tax-category-edit-cancel-btn">Cancel</button>
        <button type="button" class="btn btn-primary" id="tax-category-edit-save-btn">Save</button>
      </div>
    </div>
  </div>

  <script>
    // ===== FUNCTION INDEX =====
    // Time Utils:      nowEtParts() — Current date/time in America/New_York
    //                  slotStart(timeBlock) — Extract start hour from "HH:00 – HH:00" slot
    //                  isPastEtSlot(date, timeBlock) — Check if slot is in the past
    //                  setupAtKey(date, time) — Build "YYYY-MM-DDTHH:00" key for availability lookup
    // Availability:    loadAvailability() — Fetch unavailable slots + blocked dates from API
    //                  slotIsUnavailable(date, time) — Check if a specific slot is unavailable
    //                  renderTimeOptions() — Rebuild time dropdown based on selected date + availability
    // Booking:         (inline) — Form submit handler creates Stripe checkout session
    // Admin:           setAdminUnlocked(on) — Show/hide admin controls after password auth
    //                  loadAdminData() — Fetch bookings + blocked slots/days for admin view
    //                  renderAdminCalendar(bookings, blockedSlots, blockedDays) — Draw month grid with markers
    // Admin Actions:   setBlockedSlot(active) — Block/unblock a specific 2-hour slot via API
    //                  setBlockedDay(active) — Block/unblock an entire day via API
    // Tax Ledger:      loadTaxTransactions() — Fetch + render tax entries for selected year/type
    //                  (inline) — Add expense / Add income form handlers
    //                  (inline) — CSV export download handler
    // Modals:          openSuccessModal(text) / closeSuccessModal() — Post-payment success modal
    //                  openSimpleModal(el) / closeSimpleModal(el) — About/Terms/Privacy/Contact modals

    // ===== KEY DOM ELEMENTS =====
    // #setup-date              — Date picker for booking
    // #setup-time              — Time slot dropdown
    // #setup-name, #setup-email — Customer info fields
    // #book-btn                — "Book + Pay Now" submit button
    // #book-status             — Booking status feedback text
    // .top-book-btn            — Fixed/sticky CTA linking to #pick-setup
    // .back-btn                — Home navigation link (in first card)
    // #success-modal           — Post-payment success overlay
    // #success-date, #success-time — Confirmation details in success modal
    // #admin-panel             — Admin dashboard section (hidden by default)
    // #admin-pw                — Admin password input
    // #admin-unlock-btn        — Admin login button
    // #admin-date, #admin-time — Admin slot selection for blocking
    // #admin-block-date        — Admin date for day blocking
    // #admin-bookings-list     — Admin bookings display
    // #admin-cal               — Admin availability calendar grid
    // #tax-year, #tax-type     — Tax ledger year/type filters
    // #tax-transactions        — Tax entries display container
    // #about-modal, #contact-modal, #terms-modal, #privacy-modal — Info modals

    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== Session Flow Interactive Steps =====
    const flowDescriptions = [
      "We'll chat and see what you're looking to accomplish and what your technical background is to see how to optimize setup and daily operation for maximum effectiveness.",
      "Your OpenClaw assistant is typically up and running within 15 minutes on your hardware or cloud server.",
      "Immediately after install we run a full security audit and harden your setup before anything else.",
      "Once the setup is secure, we'll go through the basics.",
      "Next, we'll add whatever skills and tools you'd like \u2014 we'll walk through all your options in person.",
      "If desired, we'll customize your dashboard layout and preferences. We've built custom tooling to make security audits and other functionality easier and we'll install that for you, if desired.",
      "We'll go through tips for handling basic issues so you're confident on your own but we're still always just a call, text or Discord message away.",
      "Any questions you might have, we'll stay until they're all answered. If you don't have any, that's okay too! We can demo some of the cool things we use OpenClaw for instead.",
      "Continued support via Zoom, Discord, or in-person for 30 days after your session is included with your purchase."
    ];
    document.getElementById('flow-steps').addEventListener('click', e => {
      const step = e.target.closest('.flow-step');
      if (!step) return;
      const idx = parseInt(step.dataset.flow, 10);
      document.querySelectorAll('.flow-step').forEach(s => s.classList.remove('active'));
      step.classList.add('active');
      document.getElementById('flow-detail-title').textContent = step.querySelector('.flow-step-title').textContent;
      document.getElementById('flow-detail-desc').textContent = flowDescriptions[idx];
    });

    const CONTACT_API_URL = window.CONTACT_API_URL || 'https://eastern-shore-ai-contact.99redder.workers.dev/api/contact';
    const CHECKOUT_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/checkout-session');
    const AVAILABILITY_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/availability');
    const BOOKINGS_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/bookings');
    const BLOCK_SLOT_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/admin/block-slot');
    const BLOCK_DAY_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/admin/block-day');
    const TAX_TX_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/transactions');
    const TAX_EXPENSE_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/expense');
    const TAX_INCOME_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/income');
    const TAX_EXPENSE_UPDATE_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/expense/update');
    const TAX_INCOME_UPDATE_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/income/update');
    const TAX_EXPENSE_DELETE_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/expense/delete');
    const TAX_INCOME_DELETE_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/income/delete');
    const TAX_EXPORT_API_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/export.csv');
    const TAX_RECEIPT_UPLOAD_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/receipt/upload');
    const TAX_RECEIPT_URL = CONTACT_API_URL.replace('/api/contact', '/api/tax/receipt');

    const form = document.getElementById('setup-page-form');
    const statusEl = document.getElementById('status');
    const submitBtn = form.querySelector('button[type="submit"]');
    const bookPayBtn = document.getElementById('book-pay-btn');
    const contactLink = document.getElementById('contact-link');
    const aboutLink = document.getElementById('about-link');
    const termsLink = document.getElementById('terms-link');
    const privacyLink = document.getElementById('privacy-link');

    const contactModal = document.getElementById('contact-modal');
    const aboutModal = document.getElementById('about-modal');
    const termsModal = document.getElementById('terms-modal');
    const privacyModal = document.getElementById('privacy-modal');

    const contactGoBtn = document.getElementById('contact-go-btn');
    const contactCloseBtn = document.getElementById('contact-close-btn');
    const aboutCloseBtn = document.getElementById('about-close-btn');
    const termsCloseBtn = document.getElementById('terms-close-btn');
    const privacyCloseBtn = document.getElementById('privacy-close-btn');

    const successModal = document.getElementById('success-modal');
    const successTitle = document.getElementById('success-title');
    const successDetails = document.getElementById('success-details');
    const successCloseBtn = document.getElementById('success-close-btn');

    const errorModal = document.getElementById('error-modal');
    const errorDetails = document.getElementById('error-details');
    const errorCloseBtn = document.getElementById('error-close-btn');
    const confirmModal = document.getElementById('confirm-modal');
    const confirmDetails = document.getElementById('confirm-details');
    const confirmOkBtn = document.getElementById('confirm-ok-btn');
    const confirmCancelBtn = document.getElementById('confirm-cancel-btn');

    const setupDateEl = document.getElementById('setup-date');
    const setupTimeEl = document.getElementById('setup-time');

    const adminPanel = document.getElementById('admin-panel');
    const adminLock = document.getElementById('admin-lock');
    const adminControls = document.getElementById('admin-controls');
    const adminKeyEl = document.getElementById('admin-key');
    const adminUnlockBtn = document.getElementById('admin-unlock-btn');

    const bookingCollapseBtn = document.getElementById('booking-collapse-btn');
    const bookingControlsBody = document.getElementById('booking-controls-body');
    const taxCollapseBtn = document.getElementById('tax-collapse-btn');
    const taxLedgerBody = document.getElementById('tax-ledger-body');

    const taxYearEl = document.getElementById('tax-year');
    const taxTypeEl = document.getElementById('tax-type');
    const taxRefreshBtn = document.getElementById('tax-refresh-btn');
    const taxExportBtn = document.getElementById('tax-export-btn');
    const taxModeExpenseBtn = document.getElementById('tax-mode-expense-btn');
    const taxModeIncomeBtn = document.getElementById('tax-mode-income-btn');
    const taxManageCategoriesBtn = document.getElementById('tax-manage-categories-btn');
    const taxExpensePanel = document.getElementById('tax-expense-panel');
    const taxIncomePanel = document.getElementById('tax-income-panel');
    const taxExpenseFields = document.getElementById('tax-expense-fields');
    const taxIncomeFields = document.getElementById('tax-income-fields');
    const taxMinimizeExpenseBtn = document.getElementById('tax-minimize-expense-btn');
    const taxMinimizeIncomeBtn = document.getElementById('tax-minimize-income-btn');
    const taxCategoryModal = document.getElementById('tax-category-modal');
    const taxCategoryCloseBtn = document.getElementById('tax-category-close-btn');
    const taxCategoryXBtn = document.getElementById('tax-category-x-btn');
    const expenseCategoriesListEl = document.getElementById('expense-categories-list');
    const incomeCategoriesListEl = document.getElementById('income-categories-list');
    const newExpenseCategoryEl = document.getElementById('new-expense-category');
    const newIncomeCategoryEl = document.getElementById('new-income-category');
    const addExpenseCategoryBtn = document.getElementById('add-expense-category-btn');
    const addIncomeCategoryBtn = document.getElementById('add-income-category-btn');
    const taxCategoryEditModal = document.getElementById('tax-category-edit-modal');
    const taxCategoryEditInput = document.getElementById('tax-category-edit-input');
    const taxCategoryEditSaveBtn = document.getElementById('tax-category-edit-save-btn');
    const taxCategoryEditCancelBtn = document.getElementById('tax-category-edit-cancel-btn');
    const taxSummaryListEl = document.getElementById('tax-summary-list');
    const taxListEl = document.getElementById('tax-list');
    const txCategoryFilterEl = document.getElementById('tx-category-filter');
    const txFilterBtns = document.querySelectorAll('.tx-filter-btn');
    let allTxItems = [];
    let loadedTaxData = { income: [], expenses: [] };
    let activeTxFilter = 'all';

    const taxExpenseDateEl = document.getElementById('tax-expense-date');
    const taxExpenseVendorEl = document.getElementById('tax-expense-vendor');
    const taxExpenseCategoryEl = document.getElementById('tax-expense-category');
    const taxExpenseAmountEl = document.getElementById('tax-expense-amount');
    const taxExpensePaidViaEl = document.getElementById('tax-expense-paidvia');
    const taxExpenseNotesEl = document.getElementById('tax-expense-notes');
    const taxAddExpenseBtn = document.getElementById('tax-add-expense-btn');
    const taxUpdateExpenseBtn = document.getElementById('tax-update-expense-btn');
    const taxCancelExpenseEditBtn = document.getElementById('tax-cancel-expense-edit-btn');
    const taxClearExpenseBtn = document.getElementById('tax-clear-expense-btn');

    const taxIncomeDateEl = document.getElementById('tax-income-date');
    const taxIncomeSourceEl = document.getElementById('tax-income-source');
    const taxIncomeCategoryEl = document.getElementById('tax-income-category');
    const taxIncomeAmountEl = document.getElementById('tax-income-amount');
    const taxIncomeStripeEl = document.getElementById('tax-income-stripe');
    const taxIncomeNotesEl = document.getElementById('tax-income-notes');
    const taxAddIncomeBtn = document.getElementById('tax-add-income-btn');
    const taxUpdateIncomeBtn = document.getElementById('tax-update-income-btn');
    const taxCancelIncomeEditBtn = document.getElementById('tax-cancel-income-edit-btn');
    const taxClearIncomeBtn = document.getElementById('tax-clear-income-btn');

    const adminDateEl = document.getElementById('admin-date');
    const adminTimeEl = document.getElementById('admin-time');
    const adminReasonEl = document.getElementById('admin-reason');
    const adminListEl = document.getElementById('admin-list');
    const adminCalendarGridEl = document.getElementById('admin-calendar-grid');
    const adminCalendarTitleEl = document.getElementById('admin-calendar-title');
    const adminCalPrevBtn = document.getElementById('admin-cal-prev-btn');
    const adminCalNextBtn = document.getElementById('admin-cal-next-btn');
    const adminBlockBtn = document.getElementById('admin-block-btn');
    const adminUnblockBtn = document.getElementById('admin-unblock-btn');
    const adminBlockDayBtn = document.getElementById('admin-block-day-btn');
    const adminUnblockDayBtn = document.getElementById('admin-unblock-day-btn');
    const adminRefreshBtn = document.getElementById('admin-refresh-btn');

    // ===== Availability State =====
    let unavailableSlots = new Set();
    let blockedDates = new Set();
    let adminCalendarCursor = null; // Date at first day of month being viewed

    // ===== Modals =====
    /** @param {string} text - Message to display in success modal */
    function openSuccessModal(text, title) {
      if (title) successTitle.textContent = title;
      successDetails.textContent = text;
      successModal.classList.add('active');
      successModal.setAttribute('aria-hidden', 'false');
    }

    function closeSuccessModal() {
      successModal.classList.remove('active');
      successModal.setAttribute('aria-hidden', 'true');
    }

    function openErrorModal(text) {
      errorDetails.textContent = text;
      errorModal.classList.add('active');
      errorModal.setAttribute('aria-hidden', 'false');
    }

    function closeErrorModal() {
      errorModal.classList.remove('active');
      errorModal.setAttribute('aria-hidden', 'true');
    }

    function openConfirmModal(text, title = 'Please Confirm', confirmLabel = 'Confirm') {
      return new Promise((resolve) => {
        const confirmTitleEl = document.getElementById('confirm-title');
        confirmTitleEl.textContent = title;
        confirmDetails.textContent = text;
        confirmOkBtn.textContent = confirmLabel;
        confirmModal.classList.add('active');
        confirmModal.setAttribute('aria-hidden', 'false');

        const cleanup = () => {
          confirmModal.classList.remove('active');
          confirmModal.setAttribute('aria-hidden', 'true');
          confirmOkBtn.removeEventListener('click', onOk);
          confirmCancelBtn.removeEventListener('click', onCancel);
          confirmModal.removeEventListener('click', onOverlay);
        };
        const onOk = () => { cleanup(); resolve(true); };
        const onCancel = () => { cleanup(); resolve(false); };
        const onOverlay = (e) => { if (e.target === confirmModal) onCancel(); };

        confirmOkBtn.addEventListener('click', onOk);
        confirmCancelBtn.addEventListener('click', onCancel);
        confirmModal.addEventListener('click', onOverlay);
      });
    }

    /** @param {HTMLElement} el - Modal overlay element */
    function openSimpleModal(el) {
      el.classList.add('active');
      el.setAttribute('aria-hidden', 'false');
    }

    function closeSimpleModal(el) {
      el.classList.remove('active');
      el.setAttribute('aria-hidden', 'true');
    }

    const openclawInfoLink = document.getElementById('openclaw-info-link');
    const openclawInfoModal = document.getElementById('openclaw-info-modal');
    const openclawInfoCloseBtn = document.getElementById('openclaw-info-close-btn');

    openclawInfoLink.addEventListener('click', (e) => {
      e.preventDefault();
      openSimpleModal(openclawInfoModal);
    });
    openclawInfoCloseBtn.addEventListener('click', () => closeSimpleModal(openclawInfoModal));
    openclawInfoModal.addEventListener('click', (e) => {
      if (e.target === openclawInfoModal) closeSimpleModal(openclawInfoModal);
    });

    contactLink.addEventListener('click', (e) => {
      e.preventDefault();
      openSimpleModal(contactModal);
    });

    aboutLink.addEventListener('click', (e) => {
      e.preventDefault();
      openSimpleModal(aboutModal);
    });

    termsLink.addEventListener('click', (e) => {
      e.preventDefault();
      openSimpleModal(termsModal);
    });

    privacyLink.addEventListener('click', (e) => {
      e.preventDefault();
      openSimpleModal(privacyModal);
    });

    contactGoBtn.addEventListener('click', () => {
      closeSimpleModal(contactModal);
      document.getElementById('setup-page-form').scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
    contactCloseBtn.addEventListener('click', () => closeSimpleModal(contactModal));
    aboutCloseBtn.addEventListener('click', () => closeSimpleModal(aboutModal));
    termsCloseBtn.addEventListener('click', () => closeSimpleModal(termsModal));
    privacyCloseBtn.addEventListener('click', () => closeSimpleModal(privacyModal));

    contactModal.addEventListener('click', (e) => {
      if (e.target === contactModal) closeSimpleModal(contactModal);
    });
    aboutModal.addEventListener('click', (e) => {
      if (e.target === aboutModal) closeSimpleModal(aboutModal);
    });
    termsModal.addEventListener('click', (e) => {
      if (e.target === termsModal) closeSimpleModal(termsModal);
    });
    privacyModal.addEventListener('click', (e) => {
      if (e.target === privacyModal) closeSimpleModal(privacyModal);
    });

    successCloseBtn.addEventListener('click', closeSuccessModal);
    successModal.addEventListener('click', (e) => {
      if (e.target === successModal) closeSuccessModal();
    });

    errorCloseBtn.addEventListener('click', closeErrorModal);
    errorModal.addEventListener('click', (e) => {
      if (e.target === errorModal) closeErrorModal();
    });

    const TIME_SLOTS = [
      { value: '10:00-12:00', label: '1000 - 1200' },
      { value: '12:00-14:00', label: '1200 - 1400' },
      { value: '14:00-16:00', label: '1400 - 1600' },
      { value: '16:00-18:00', label: '1600 - 1800' },
      { value: '18:00-20:00', label: '1800 - 2000' }
    ];

    // ===== Time Utilities =====
    /** @returns {{ date: string, hour: number }} Current date (YYYY-MM-DD) and hour in ET */
    function nowEtParts() {
      const parts = new Intl.DateTimeFormat('en-CA', {
        timeZone: 'America/New_York',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      }).formatToParts(new Date());
      const get = (t) => parts.find(p => p.type === t)?.value;
      return {
        date: `${get('year')}-${get('month')}-${get('day')}`,
        time: `${get('hour')}:${get('minute')}`
      };
    }

    /** @param {string} timeBlock - e.g. "10:00-12:00" @returns {number} Start hour */
    function slotStart(timeBlock) {
      return (timeBlock || '').split('-')[0] || '';
    }

    /** @param {string} date - YYYY-MM-DD @param {string} timeBlock - e.g. "10:00-12:00" @returns {boolean} */
    function isPastEtSlot(date, timeBlock) {
      if (!date || !timeBlock) return false;
      const now = nowEtParts();
      const start = slotStart(timeBlock);
      if (!start) return false;
      if (date < now.date) return true;
      if (date > now.date) return false;
      return start <= now.time;
    }

    function setupAtKey(date, time) {
      return date && time ? `${date}T${time}` : '';
    }

    // ===== Availability & Booking =====
    /** Rebuild time dropdown options based on selected date, availability, and current time */
    function renderTimeOptions() {
      const selectedDate = setupDateEl.value;
      const current = setupTimeEl.value;
      const adminCurrent = adminTimeEl.value;
      const userOpts = ['<option value="">Select time block…</option>'];
      const adminOpts = ['<option value="">Select block…</option>'];

      // past date guard (ET)
      if (selectedDate) {
        const now = nowEtParts();
        if (selectedDate < now.date) {
          userOpts.push('<option value="" disabled>Date has already passed</option>');
        }
      }

      if (selectedDate && blockedDates.has(selectedDate)) {
        userOpts.push('<option value="" disabled>Entire day is blocked</option>');
      }

      for (const slot of TIME_SLOTS) {
        const unavailable = selectedDate && (slotIsUnavailable(selectedDate, slot.value) || isPastEtSlot(selectedDate, slot.value));
        userOpts.push(`<option value="${slot.value}" ${unavailable ? 'disabled' : ''}>${slot.label}${unavailable ? ' (unavailable)' : ''}</option>`);
        adminOpts.push(`<option value="${slot.value}">${slot.label}</option>`);
      }

      setupTimeEl.innerHTML = userOpts.join('');
      adminTimeEl.innerHTML = adminOpts.join('');

      if (current && !(selectedDate && (slotIsUnavailable(selectedDate, current) || isPastEtSlot(selectedDate, current)))) {
        setupTimeEl.value = current;
      }
      if (adminCurrent) {
        adminTimeEl.value = adminCurrent;
      }
    }

    /** Fetch unavailable slots and blocked dates from /api/availability */
    async function loadAvailability() {
      try {
        const res = await fetch(AVAILABILITY_API_URL, { headers: { 'Content-Type': 'application/json' } });
        const data = await res.json();
        unavailableSlots = new Set((data.unavailable || []).filter(Boolean));
        blockedDates = new Set((data.blockedDates || []).filter(Boolean));
      } catch {
        unavailableSlots = new Set();
        blockedDates = new Set();
      }
      renderTimeOptions();
    }

    /** @param {string} date - YYYY-MM-DD @param {string} time - e.g. "10:00-12:00" @returns {boolean} */
    function slotIsUnavailable(date, time) {
      if (blockedDates.has(date)) return true;
      return unavailableSlots.has(setupAtKey(date, time));
    }

    // prevent selecting past days in UI (ET date)
    try {
      setupDateEl.min = nowEtParts().date;
    } catch {}

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && contactModal.classList.contains('active')) closeSimpleModal(contactModal);
      if (e.key === 'Escape' && aboutModal.classList.contains('active')) closeSimpleModal(aboutModal);
      if (e.key === 'Escape' && termsModal.classList.contains('active')) closeSimpleModal(termsModal);
      if (e.key === 'Escape' && privacyModal.classList.contains('active')) closeSimpleModal(privacyModal);
      if (e.key === 'Escape' && successModal.classList.contains('active')) closeSuccessModal();
    });

    setupDateEl.addEventListener('change', renderTimeOptions);
    const adminMode = new URLSearchParams(window.location.search).get('admin') === '1';
    let adminUnlocked = false;
    if (adminMode) {
      document.body.classList.add('admin-mode');
      adminPanel.classList.add('active');
      // Do not persist admin password in storage.
      adminKeyEl.value = '';
    }

    // ===== Admin Controls =====
    /** @param {boolean} on - true to show admin controls, false to hide */
    function setAdminUnlocked(on) {
      adminUnlocked = !!on;
      adminLock.style.display = adminUnlocked ? 'none' : 'block';
      adminControls.classList.toggle('active', adminUnlocked);
    }

    /**
     * Draw admin calendar grid showing booked/blocked days for the month
     * @param {Array} bookings - Booking records from D1
     * @param {Array} blockedSlots - Blocked 2-hour slot records
     * @param {Array} blockedDays - Blocked full-day records
     */
    function renderAdminCalendar(bookings = [], blockedSlots = [], blockedDays = []) {
      const cursor = adminCalendarCursor || new Date();
      const year = cursor.getFullYear();
      const month = cursor.getMonth();
      const first = new Date(year, month, 1);
      const last = new Date(year, month + 1, 0);
      const daysInMonth = last.getDate();
      const startDow = first.getDay();

      const openclawByDay = new Map();
      const lessonsByDay = new Map();
      const blockedByDay = new Map();
      const blockedWholeDay = new Set();

      for (const b of bookings) {
        const d = (b.setup_date || '').trim();
        if (!d) continue;
        const isLessons = (b.service_type || '').toLowerCase() === 'lessons';
        if (isLessons) {
          lessonsByDay.set(d, (lessonsByDay.get(d) || 0) + 1);
        } else {
          openclawByDay.set(d, (openclawByDay.get(d) || 0) + 1);
        }
      }
      for (const s of blockedSlots) {
        if (!s.active) continue;
        const d = (s.setup_date || '').trim();
        if (!d) continue;
        blockedByDay.set(d, (blockedByDay.get(d) || 0) + 1);
      }
      for (const d of blockedDays) {
        if (!d.active) continue;
        const key = (d.setup_date || '').trim();
        if (!key) continue;
        blockedWholeDay.add(key);
        blockedByDay.set(key, (blockedByDay.get(key) || 0) + 1);
      }

      const monthName = first.toLocaleString('en-US', { month: 'long' });
      adminCalendarTitleEl.textContent = `Availability Calendar — ${monthName} ${year}`;

      const parts = [];
      const dows = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      for (const d of dows) parts.push(`<div class="admin-cal-dow">${d}</div>`);

      for (let i = 0; i < startDow; i++) {
        parts.push('<div class="admin-cal-day empty"></div>');
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const mm = String(month + 1).padStart(2, '0');
        const dd = String(day).padStart(2, '0');
        const key = `${year}-${mm}-${dd}`;
        const openclawCount = openclawByDay.get(key) || 0;
        const lessonsCount = lessonsByDay.get(key) || 0;
        const xCount = blockedByDay.get(key) || 0;
        const dots = [];
        for (let i = 0; i < Math.min(3, openclawCount); i++) dots.push('<i class="admin-dot booked-openclaw" title="OpenClaw booking"></i>');
        for (let i = 0; i < Math.min(3, lessonsCount); i++) dots.push('<i class="admin-dot booked-lessons" title="Lessons booking"></i>');
        if (blockedWholeDay.has(key)) {
          dots.push('<i class="admin-dot blocked" title="Entire day blocked"></i>');
        } else {
          for (let i = 0; i < Math.min(3, xCount); i++) dots.push('<i class="admin-dot blocked" title="Blocked"></i>');
        }
        parts.push(`<div class="admin-cal-day"><div class="admin-cal-day-num">${day}</div><div class="admin-cal-dots">${dots.join('')}</div></div>`);
      }

      adminCalendarGridEl.innerHTML = parts.join('');
    }

    /** Fetch bookings, blocked slots/days from /api/bookings and refresh admin UI */
    async function loadAdminData() {
      if (!adminMode || !adminUnlocked) return;
      const key = adminKeyEl.value.trim();
      try {
        const res = await fetch(`${BOOKINGS_API_URL}?limit=200`, {
          headers: { 'X-Admin-Password': key }
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Failed');
        const bookingRows = (data.bookings || []).map((b) => {
          const svc = b.service_type === 'lessons' ? 'LESSONS' : 'OPENCLAW';
          return `<div>[BOOKING:${svc}] ${b.status} | ${b.setup_at || '(n/a)'} | ${b.customer_name || '(no name)'}</div>`;
        });

        const blockedSlotRows = (data.blockedSlots || []).map((s) => {
          const key = `${s.setup_date || ''}|${s.setup_time || ''}`;
          return `<div style="display:flex; align-items:center; justify-content:space-between; gap:.5rem;"><span>[BLOCKED SLOT] ${s.active ? 'active' : 'inactive'} | ${s.setup_at} | ${s.reason || '(no reason)'}</span><button type="button" class="btn delete" data-blocked-slot-delete="${key}">Delete</button></div>`;
        });

        const blockedDayRows = (data.blockedDays || []).map((d) => {
          const key = `${d.setup_date || ''}`;
          return `<div style="display:flex; align-items:center; justify-content:space-between; gap:.5rem;"><span>[BLOCKED DAY] ${d.active ? 'active' : 'inactive'} | ${d.setup_date} | ${d.reason || '(no reason)'}</span><button type="button" class="btn delete" data-blocked-day-delete="${key}">Delete</button></div>`;
        });

        const html = [...bookingRows, ...blockedSlotRows, ...blockedDayRows].join('');
        adminListEl.innerHTML = html || 'No records yet.';

        adminListEl.querySelectorAll('[data-blocked-slot-delete]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const raw = btn.getAttribute('data-blocked-slot-delete') || '';
            const [setupDate, setupTime] = raw.split('|');
            if (!setupDate || !setupTime) return;
            const ok = await openConfirmModal(`Delete blocked slot ${setupDate} ${setupTime}?`, 'Delete Blocked Slot?', 'Delete');
            if (!ok) return;
            try {
              await fetch(`${BLOCK_SLOT_API_URL}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-Admin-Password': key },
                body: JSON.stringify({ setupDate, setupTime, reason: '', active: false })
              });
              await loadAvailability();
              await loadAdminData();
              openSuccessModal('Blocked slot deleted successfully.', 'Record Deleted ✅');
            } catch (e) {
              openErrorModal(`Could not delete blocked slot: ${e.message || e}`);
            }
          });
        });

        adminListEl.querySelectorAll('[data-blocked-day-delete]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const setupDate = btn.getAttribute('data-blocked-day-delete') || '';
            if (!setupDate) return;
            const ok = await openConfirmModal(`Delete blocked day ${setupDate}?`, 'Delete Blocked Day?', 'Delete');
            if (!ok) return;
            try {
              await fetch(`${BLOCK_DAY_API_URL}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-Admin-Password': key },
                body: JSON.stringify({ setupDate, reason: '', active: false })
              });
              await loadAvailability();
              await loadAdminData();
              openSuccessModal('Blocked day deleted successfully.', 'Record Deleted ✅');
            } catch (e) {
              openErrorModal(`Could not delete blocked day: ${e.message || e}`);
            }
          });
        });

        renderAdminCalendar(data.bookings || [], data.blockedSlots || [], data.blockedDays || []);
      } catch (e) {
        adminListEl.textContent = `Error loading admin data: ${e.message || e}`;
      }
    }

    /** @param {boolean} active - true to block, false to unblock the selected slot */
    async function setBlockedSlot(active) {
      const key = adminKeyEl.value.trim();
      const setupDate = adminDateEl.value;
      const setupTime = adminTimeEl.value;
      if (!key || !setupDate || !setupTime) {
        openErrorModal('Admin password + date + time are required.');
        return;
      }
      const proceed = await openConfirmModal(
        `${active ? 'Block' : 'Unblock'} slot ${setupDate} ${setupTime}?`,
        active ? 'Block Slot?' : 'Unblock Slot?',
        active ? 'Block' : 'Unblock'
      );
      if (!proceed) return;
      try {
        const res = await fetch(`${BLOCK_SLOT_API_URL}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'X-Admin-Password': key },
          body: JSON.stringify({
            setupDate,
            setupTime,
            reason: adminReasonEl.value.trim(),
            active
          })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Failed to update slot');
        await loadAvailability();
        await loadAdminData();
        openSuccessModal(`Slot ${active ? 'blocked' : 'unblocked'} successfully.`, active ? 'Slot Blocked ✅' : 'Slot Unblocked ✅');
      } catch (e) {
        openErrorModal(`Could not update slot: ${e.message || e}`);
      }
    }

    /** @param {boolean} active - true to block, false to unblock the selected day */
    async function setBlockedDay(active) {
      const key = adminKeyEl.value.trim();
      const setupDate = adminDateEl.value;
      if (!key || !setupDate) {
        openErrorModal('Admin password + date are required.');
        return;
      }
      const proceed = await openConfirmModal(
        `${active ? 'Block' : 'Unblock'} day ${setupDate}?`,
        active ? 'Block Day?' : 'Unblock Day?',
        active ? 'Block' : 'Unblock'
      );
      if (!proceed) return;
      try {
        const res = await fetch(`${BLOCK_DAY_API_URL}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'X-Admin-Password': key },
          body: JSON.stringify({
            setupDate,
            reason: adminReasonEl.value.trim(),
            active
          })
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Failed to update day');
        await loadAvailability();
        await loadAdminData();
        openSuccessModal(`Day ${active ? 'blocked' : 'unblocked'} successfully.`, active ? 'Day Blocked ✅' : 'Day Unblocked ✅');
      } catch (e) {
        openErrorModal(`Could not update day: ${e.message || e}`);
      }
    }

    // ===== Admin Mode Initialization & Tax Ledger =====
    if (adminMode) {
      setAdminUnlocked(false);
      let adminPassword = '';

      const DEFAULT_TAX_EXPENSE_CATEGORIES = [
        'Startup cost',
        'Advertising/Marketing',
        'Software/SaaS',
        'Hosting/Cloud',
        'Hardware',
        'Office Supplies',
        'Travel',
        'Meals',
        'Education',
        'Professional Services',
        'Payment Processing Fees',
        'Other'
      ];

      const DEFAULT_TAX_INCOME_CATEGORIES = [
        'OpenClaw Setup',
        'Consulting',
        'Website Design',
        'AI Lessons',
        'Domain Sale',
        'Other'
      ];

      let TAX_EXPENSE_CATEGORIES = [...DEFAULT_TAX_EXPENSE_CATEGORIES];
      let TAX_INCOME_CATEGORIES = [...DEFAULT_TAX_INCOME_CATEGORIES];

      function escHtml(v) {
        return String(v == null ? '' : v)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/"/g, '&quot;')
          .replace(/'/g, '&#39;');
      }

      function saveCategoryPrefs() {
        localStorage.setItem('esa_tax_expense_categories', JSON.stringify(TAX_EXPENSE_CATEGORIES));
        localStorage.setItem('esa_tax_income_categories', JSON.stringify(TAX_INCOME_CATEGORIES));
      }

      function loadCategoryPrefs() {
        try {
          const exp = JSON.parse(localStorage.getItem('esa_tax_expense_categories') || 'null');
          const inc = JSON.parse(localStorage.getItem('esa_tax_income_categories') || 'null');
          if (Array.isArray(exp) && exp.length) TAX_EXPENSE_CATEGORIES = [...new Set(exp.map(v => String(v).trim()).filter(Boolean))];
          if (Array.isArray(inc) && inc.length) TAX_INCOME_CATEGORIES = [...new Set(inc.map(v => String(v).trim()).filter(Boolean))];
        } catch {}
      }

      function renderCategoryOptions() {
        taxExpenseCategoryEl.innerHTML = TAX_EXPENSE_CATEGORIES.map(c => `<option value="${escHtml(c)}">${escHtml(c)}</option>`).join('');
        taxIncomeCategoryEl.innerHTML = TAX_INCOME_CATEGORIES.map(c => `<option value="${escHtml(c)}">${escHtml(c)}</option>`).join('');
      }

      function openCategoryEditModal(currentName) {
        return new Promise((resolve) => {
          taxCategoryEditInput.value = currentName || '';
          taxCategoryEditModal.classList.add('active');
          taxCategoryEditModal.setAttribute('aria-hidden', 'false');
          taxCategoryEditInput.focus();
          taxCategoryEditInput.select();

          const cleanup = () => {
            taxCategoryEditModal.classList.remove('active');
            taxCategoryEditModal.setAttribute('aria-hidden', 'true');
            taxCategoryEditSaveBtn.removeEventListener('click', onSave);
            taxCategoryEditCancelBtn.removeEventListener('click', onCancel);
            taxCategoryEditModal.removeEventListener('click', onOverlay);
          };
          const onSave = () => { const v = (taxCategoryEditInput.value || '').trim(); cleanup(); resolve(v || null); };
          const onCancel = () => { cleanup(); resolve(null); };
          const onOverlay = (e) => { if (e.target === taxCategoryEditModal) onCancel(); };

          taxCategoryEditSaveBtn.addEventListener('click', onSave);
          taxCategoryEditCancelBtn.addEventListener('click', onCancel);
          taxCategoryEditModal.addEventListener('click', onOverlay);
        });
      }

      function renderCategoryManagerLists() {
        if (!expenseCategoriesListEl || !incomeCategoriesListEl) return;
        expenseCategoriesListEl.innerHTML = TAX_EXPENSE_CATEGORIES.map(c => `<div style="display:flex; gap:.35rem; align-items:center;"><span style="flex:1;">${escHtml(c)}</span><button type="button" class="btn" data-cat-edit="expense" data-cat-name="${encodeURIComponent(c)}">Edit</button><button type="button" class="btn delete" data-cat-del="expense" data-cat-name="${encodeURIComponent(c)}">Delete</button></div>`).join('');
        incomeCategoriesListEl.innerHTML = TAX_INCOME_CATEGORIES.map(c => `<div style="display:flex; gap:.35rem; align-items:center;"><span style="flex:1;">${escHtml(c)}</span><button type="button" class="btn" data-cat-edit="income" data-cat-name="${encodeURIComponent(c)}">Edit</button><button type="button" class="btn delete" data-cat-del="income" data-cat-name="${encodeURIComponent(c)}">Delete</button></div>`).join('');

        (taxCategoryModal || document).querySelectorAll('[data-cat-edit]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const type = btn.getAttribute('data-cat-edit');
            const oldName = decodeURIComponent(btn.getAttribute('data-cat-name') || '');
            const newName = await openCategoryEditModal(oldName);
            if (!newName || newName === oldName) return;
            const list = type === 'income' ? TAX_INCOME_CATEGORIES : TAX_EXPENSE_CATEGORIES;
            if (list.some(c => c.toLowerCase() === newName.toLowerCase())) {
              openErrorModal('That category name already exists.');
              return;
            }
            const rows = type === 'income' ? (loadedTaxData.income || []) : (loadedTaxData.expenses || []);
            if (rows.some(r => String(r.category || '') === oldName)) {
              openErrorModal(`Can't rename "${oldName}" because records already use it. Reclassify those transactions first.`);
              return;
            }
            if (type === 'income') {
              TAX_INCOME_CATEGORIES = TAX_INCOME_CATEGORIES.map(c => c === oldName ? newName : c);
            } else {
              TAX_EXPENSE_CATEGORIES = TAX_EXPENSE_CATEGORIES.map(c => c === oldName ? newName : c);
            }
            saveCategoryPrefs();
            renderCategoryOptions();
            renderCategoryManagerLists();
            openSuccessModal('Category updated.', 'Category Updated ✅');
          });
        });

        (taxCategoryModal || document).querySelectorAll('[data-cat-del]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const type = btn.getAttribute('data-cat-del');
            const name = decodeURIComponent(btn.getAttribute('data-cat-name') || '');
            const rows = type === 'income' ? (loadedTaxData.income || []) : (loadedTaxData.expenses || []);
            if (rows.some(r => String(r.category || '') === name)) {
              openErrorModal(`Can't delete "${name}". Reclassify transactions in this category before deleting it.`);
              return;
            }
            const ok = await openConfirmModal(`Delete category "${name}"?`, 'Delete Category?', 'Delete');
            if (!ok) return;
            if (type === 'income') {
              TAX_INCOME_CATEGORIES = TAX_INCOME_CATEGORIES.filter(c => c !== name);
            } else {
              TAX_EXPENSE_CATEGORIES = TAX_EXPENSE_CATEGORIES.filter(c => c !== name);
            }
            saveCategoryPrefs();
            renderCategoryOptions();
            renderCategoryManagerLists();
            openSuccessModal('Category deleted.', 'Category Deleted ✅');
          });
        });
      }

      function formatTaxRowLabel(type, r) {
        const counterparty = type === 'income' ? (r.source || '') : (r.vendor || '');
        return `${r.date} | ${r.category || ''} | ${counterparty} | ${r.notes || ''}`;
      }

      async function editTaxRecord(type, r) {
        if (type === 'expense') {
          setTaxEntryMode('expense');
          editingExpenseId = Number(r.id || 0);
          taxExpenseDateEl.value = r.date || '';
          taxExpenseVendorEl.value = r.vendor || '';
          taxExpenseCategoryEl.value = r.category || TAX_EXPENSE_CATEGORIES[0];
          taxExpenseAmountEl.value = ((Number(r.amount_cents || 0))/100).toFixed(2);
          taxExpensePaidViaEl.value = r.paid_via || '';
          taxExpenseNotesEl.value = r.notes || '';
          taxAddExpenseBtn.style.display = 'none';
          taxUpdateExpenseBtn.style.display = '';
          taxCancelExpenseEditBtn.style.display = '';
          taxExpenseAmountEl.focus();
        } else {
          setTaxEntryMode('income');
          editingIncomeId = Number(r.id || 0);
          taxIncomeDateEl.value = r.date || '';
          taxIncomeSourceEl.value = r.source || '';
          taxIncomeCategoryEl.value = r.category || TAX_INCOME_CATEGORIES[0];
          taxIncomeAmountEl.value = ((Number(r.amount_cents || 0))/100).toFixed(2);
          taxIncomeStripeEl.value = r.stripe_session_id || '';
          taxIncomeNotesEl.value = r.notes || '';
          taxAddIncomeBtn.style.display = 'none';
          taxUpdateIncomeBtn.style.display = '';
          taxCancelIncomeEditBtn.style.display = '';
          taxIncomeAmountEl.focus();
        }
      }

      let editingExpenseId = null;
      let editingIncomeId = null;

      function resetExpenseEditMode() {
        editingExpenseId = null;
        taxAddExpenseBtn.style.display = '';
        taxUpdateExpenseBtn.style.display = 'none';
        taxCancelExpenseEditBtn.style.display = 'none';
      }

      function resetIncomeEditMode() {
        editingIncomeId = null;
        taxAddIncomeBtn.style.display = '';
        taxUpdateIncomeBtn.style.display = 'none';
        taxCancelIncomeEditBtn.style.display = 'none';
      }

      async function deleteTaxRecord(type, r) {
        const amount = (Number(r.amount_cents||0)/100).toFixed(2);
        const confirmed = await openConfirmModal(
          `Delete this ${type} record from ${r.date} for $${amount}? This cannot be undone.`,
          'Delete Record?',
          'Delete'
        );
        if (!confirmed) return false;

        const url = type === 'income' ? TAX_INCOME_DELETE_API_URL : TAX_EXPENSE_DELETE_API_URL;
        const res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'X-Admin-Password': adminPassword },
          body: JSON.stringify({ id: r.id })
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(data.error || 'Delete failed');
        return true;
      }

      function setTaxEntryMode(mode) {
        const showExpense = mode === 'expense';
        const showIncome = mode === 'income';
        if (taxExpensePanel) taxExpensePanel.style.display = showExpense ? '' : 'none';
        if (taxIncomePanel) taxIncomePanel.style.display = showIncome ? '' : 'none';
        if (taxExpenseFields) taxExpenseFields.style.display = showExpense ? '' : 'none';
        if (taxIncomeFields) taxIncomeFields.style.display = showIncome ? '' : 'none';
        if (taxMinimizeExpenseBtn) taxMinimizeExpenseBtn.textContent = 'Minimize';
        if (taxMinimizeIncomeBtn) taxMinimizeIncomeBtn.textContent = 'Minimize';
        if (taxModeExpenseBtn) taxModeExpenseBtn.classList.toggle('active', showExpense);
        if (taxModeIncomeBtn) taxModeIncomeBtn.classList.toggle('active', showIncome);
      }

      function initTaxUiDefaults() {

        const now = nowEtParts();
        const thisYear = Number(now.date.split('-')[0] || new Date().getFullYear());
        const years = [thisYear, thisYear - 1, thisYear - 2, thisYear - 3];
        taxYearEl.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join('');
        taxYearEl.value = String(thisYear);

        renderCategoryOptions();

        taxExpenseDateEl.value = now.date;
        taxIncomeDateEl.value = now.date;
        setTaxEntryMode('none');
      }

      function renderTxList() {
        let filtered = allTxItems;
        if (activeTxFilter !== 'all') {
          filtered = filtered.filter(r => r.type === activeTxFilter);
        }
        const selCat = txCategoryFilterEl.value;
        if (activeTxFilter === 'expense' && selCat) {
          filtered = filtered.filter(r => (r.category || '') === selCat);
        }
        if (!filtered.length) {
          taxListEl.textContent = activeTxFilter === 'all' ? 'No transactions yet.' : `No ${activeTxFilter} entries.`;
          return;
        }
        taxListEl.innerHTML = filtered.map((r) => {
          const receiptBtn = r.receipt_key
            ? `<a href="${TAX_RECEIPT_URL}?key=${encodeURIComponent(r.receipt_key)}&key2=${encodeURIComponent(adminPassword)}" target="_blank" class="btn" style="font-size:0.78rem; padding:0.2rem 0.5rem;">Receipt ↗</a>`
            : `<label class="btn" style="font-size:0.78rem; padding:0.2rem 0.5rem; cursor:pointer;" title="Upload receipt">+ Receipt<input type="file" accept=".pdf,.jpg,.jpeg,.png" class="inline-receipt-input" data-upload-type="${r.type}" data-upload-id="${r.id}" style="display:none;"></label>`;
          return `
          <div class="tax-row" data-type="${r.type}" data-id="${r.id}">
            <span class="type">${r.type.toUpperCase()}</span>
            <span class="desc" title="${escHtml(formatTaxRowLabel(r.type, r))}">${escHtml(formatTaxRowLabel(r.type, r))}</span>
            <span class="amt">$${(Number(r.amount_cents || 0)/100).toFixed(2)}</span>
            <div style="display:flex; gap:.3rem; flex-wrap:wrap;">${receiptBtn}<button type="button" class="btn edit" data-tax-edit="1">Edit</button><button type="button" class="btn delete" data-tax-delete="1">Delete</button></div>
          </div>`;
        }).join('');

        taxListEl.querySelectorAll('[data-tax-edit="1"]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const row = btn.closest('.tax-row');
            const id = Number(row?.getAttribute('data-id') || 0);
            const type = row?.getAttribute('data-type');
            const sourceList = type === 'income' ? (loadedTaxData.income || []) : (loadedTaxData.expenses || []);
            const record = sourceList.find(x => Number(x.id) === id);
            if (!record) return;
            try {
              await editTaxRecord(type, record);
              openSuccessModal('Record loaded into the form. Make your changes and click Update.', 'Edit Mode Ready ✏️');
            } catch (e) {
              openErrorModal(`Could not open transaction for edit: ${e.message || e}`);
            }
          });
        });

        taxListEl.querySelectorAll('[data-tax-delete="1"]').forEach((btn) => {
          btn.addEventListener('click', async () => {
            const row = btn.closest('.tax-row');
            const id = Number(row?.getAttribute('data-id') || 0);
            const type = row?.getAttribute('data-type');
            const sourceList = type === 'income' ? (loadedTaxData.income || []) : (loadedTaxData.expenses || []);
            const record = sourceList.find(x => Number(x.id) === id);
            if (!record) return;
            try {
              const deleted = await deleteTaxRecord(type, record);
              if (!deleted) return;
              await loadTaxTransactions();
              openSuccessModal('Transaction deleted successfully.', 'Record Deleted ✅');
            } catch (e) {
              openErrorModal(`Could not delete transaction: ${e.message || e}`);
            }
          });
        });

        taxListEl.querySelectorAll('.inline-receipt-input').forEach((input) => {
          input.addEventListener('change', async () => {
            if (!input.files[0]) return;
            const type = input.getAttribute('data-upload-type');
            const id = input.getAttribute('data-upload-id');
            try {
              await uploadReceipt(type, id, input);
              await loadTaxTransactions();
            } catch (e) {
              openErrorModal(`Receipt upload failed: ${e.message || e}`);
            }
          });
        });
      }

      async function loadTaxTransactions() {
        if (!adminUnlocked) return;
        const year = taxYearEl.value;
        const type = taxTypeEl.value;
        try {
          const res = await fetch(`${TAX_TX_API_URL}?year=${encodeURIComponent(year)}&type=${encodeURIComponent(type)}&limit=5000`, {
            headers: { 'X-Admin-Password': adminPassword }
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Failed');

          const items = [
            ...(data.income || []).map(r => ({ type: 'income', ...r })),
            ...(data.expenses || []).map(r => ({ type: 'expense', ...r }))
          ].sort((a,b) => {
            const ad = String(a.date || '');
            const bd = String(b.date || '');
            if (ad !== bd) return bd.localeCompare(ad);
            return Number(b.id || 0) - Number(a.id || 0);
          });

          // Totals snapshot for selected year
          const incomeByCategory = new Map();
          const expenseByCategory = new Map();
          let incomeTotal = 0;
          let expenseTotal = 0;

          for (const r of (data.income || [])) {
            const c = r.category || 'Uncategorized';
            const v = Number(r.amount_cents || 0);
            incomeTotal += v;
            incomeByCategory.set(c, (incomeByCategory.get(c) || 0) + v);
          }
          for (const r of (data.expenses || [])) {
            const c = r.category || 'Uncategorized';
            const v = Number(r.amount_cents || 0);
            expenseTotal += v;
            expenseByCategory.set(c, (expenseByCategory.get(c) || 0) + v);
          }

          const sortedIncome = [...incomeByCategory.entries()].sort((a,b) => b[1]-a[1]);
          const sortedExpense = [...expenseByCategory.entries()].sort((a,b) => b[1]-a[1]);

          const incomeRows = sortedIncome.length
            ? sortedIncome.map(([cat, cents]) => `<div class="tax-summary-line"><span>${cat}</span><strong>$${(cents/100).toFixed(2)}</strong></div>`).join('')
            : '<div class="tax-summary-line"><span>No income entries</span><strong>$0.00</strong></div>';

          const expenseRows = sortedExpense.length
            ? sortedExpense.map(([cat, cents]) => `<div class="tax-summary-line"><span>${cat}</span><strong>$${(cents/100).toFixed(2)}</strong></div>`).join('')
            : '<div class="tax-summary-line"><span>No expense entries</span><strong>$0.00</strong></div>';

          taxSummaryListEl.innerHTML = `
            <div class="tax-summary-col">
              <h4>Income (${year})</h4>
              <div class="tax-summary-line"><span>Total</span><strong>$${(incomeTotal/100).toFixed(2)}</strong></div>
              ${incomeRows}
            </div>
            <div class="tax-summary-col">
              <h4>Expenses (${year})</h4>
              <div class="tax-summary-line"><span>Total</span><strong>$${(expenseTotal/100).toFixed(2)}</strong></div>
              ${expenseRows}
              <div class="tax-summary-line" style="margin-top:.4rem; border-top:1px solid var(--line); padding-top:.4rem;"><span>Net</span><strong>$${((incomeTotal - expenseTotal)/100).toFixed(2)}</strong></div>
            </div>
          `;
                    allTxItems = items;
          loadedTaxData = data;
          txCategoryFilterEl.innerHTML = '<option value="">All Categories</option>' +
            TAX_EXPENSE_CATEGORIES.map(c => `<option value="${c}">${c}</option>`).join('');
          renderTxList();
        } catch (e) {
          taxSummaryListEl.innerHTML = `<div class="tax-summary-col"><h4>Summary</h4><div class="tax-summary-line"><span>Error</span><strong>${(e.message || e)}</strong></div></div>`;
          taxListEl.textContent = `Error loading tax transactions: ${e.message || e}`;
        }
      }

      function clearTaxExpenseForm() {
        const now = nowEtParts();
        taxExpenseDateEl.value = now.date;
        taxExpenseVendorEl.value = '';
        taxExpenseAmountEl.value = '';
        taxExpensePaidViaEl.value = '';
        taxExpenseNotesEl.value = '';
        const expReceiptEl = document.getElementById('tax-expense-receipt');
        if (expReceiptEl) expReceiptEl.value = '';
        const expReceiptNameEl = document.getElementById('tax-expense-receipt-name');
        if (expReceiptNameEl) expReceiptNameEl.textContent = 'No file chosen';
        if (taxExpenseCategoryEl.options.length) taxExpenseCategoryEl.selectedIndex = 0;
        resetExpenseEditMode();
      }

      function clearTaxIncomeForm() {
        const now = nowEtParts();
        taxIncomeDateEl.value = now.date;
        taxIncomeSourceEl.value = '';
        taxIncomeAmountEl.value = '';
        taxIncomeStripeEl.value = '';
        taxIncomeNotesEl.value = '';
        const incReceiptEl = document.getElementById('tax-income-receipt');
        if (incReceiptEl) incReceiptEl.value = '';
        const incReceiptNameEl = document.getElementById('tax-income-receipt-name');
        if (incReceiptNameEl) incReceiptNameEl.textContent = 'No file chosen';
        if (taxIncomeCategoryEl.options.length) taxIncomeCategoryEl.selectedIndex = 0;
        resetIncomeEditMode();
      }

      async function addTaxExpense() {
        const payload = {
          date: taxExpenseDateEl.value,
          vendor: taxExpenseVendorEl.value.trim(),
          category: taxExpenseCategoryEl.value,
          amount: taxExpenseAmountEl.value,
          paidVia: taxExpensePaidViaEl.value.trim(),
          notes: taxExpenseNotesEl.value.trim()
        };
        if (!payload.date || !payload.category || !payload.amount) {
          openErrorModal('Expense date, category, and amount are required.');
          return;
        }
        const isEdit = !!editingExpenseId;
        const proceed = await openConfirmModal(
          isEdit ? 'Save changes to this expense record?' : 'Add this new expense record?',
          isEdit ? 'Update Expense?' : 'Add Expense?',
          isEdit ? 'Update' : 'Add'
        );
        if (!proceed) return;
        try {
          const targetUrl = isEdit ? TAX_EXPENSE_UPDATE_API_URL : TAX_EXPENSE_API_URL;
          if (editingExpenseId) payload.id = editingExpenseId;
          const res = await fetch(targetUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'X-Admin-Password': adminPassword },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Failed');
          const receiptInput = document.getElementById('tax-expense-receipt');
          if (data.id && receiptInput) {
            await uploadReceipt('expense', data.id, receiptInput).catch(() => {});
            receiptInput.value = '';
          }
          clearTaxExpenseForm();
          await loadTaxTransactions();
          openSuccessModal(isEdit ? 'Expense record updated successfully.' : 'Expense record added successfully.', isEdit ? 'Expense Updated ✅' : 'Expense Added ✅');
        } catch (e) {
          openErrorModal(`Could not save expense: ${e.message || e}`);
        }
      }

      async function addTaxIncome() {
        const payload = {
          date: taxIncomeDateEl.value,
          source: taxIncomeSourceEl.value.trim(),
          category: taxIncomeCategoryEl.value,
          amount: taxIncomeAmountEl.value,
          stripeSessionId: taxIncomeStripeEl.value.trim(),
          notes: taxIncomeNotesEl.value.trim()
        };
        if (!payload.date || !payload.category || !payload.amount) {
          openErrorModal('Income date, category, and amount are required.');
          return;
        }
        const isEdit = !!editingIncomeId;
        const proceed = await openConfirmModal(
          isEdit ? 'Save changes to this income record?' : 'Add this new income record?',
          isEdit ? 'Update Income?' : 'Add Income?',
          isEdit ? 'Update' : 'Add'
        );
        if (!proceed) return;
        try {
          const targetUrl = isEdit ? TAX_INCOME_UPDATE_API_URL : TAX_INCOME_API_URL;
          if (editingIncomeId) payload.id = editingIncomeId;
          const res = await fetch(targetUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'X-Admin-Password': adminPassword },
            body: JSON.stringify(payload)
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Failed');
          const receiptInput = document.getElementById('tax-income-receipt');
          if (data.id && receiptInput) {
            await uploadReceipt('income', data.id, receiptInput).catch(() => {});
            receiptInput.value = '';
          }
          clearTaxIncomeForm();
          await loadTaxTransactions();
          openSuccessModal(isEdit ? 'Income record updated successfully.' : 'Income record added successfully.', isEdit ? 'Income Updated ✅' : 'Income Added ✅');
        } catch (e) {
          openErrorModal(`Could not save income: ${e.message || e}`);
        }
      }

      async function uploadReceipt(type, id, fileInput) {
        if (!fileInput.files[0]) return;
        const fd = new FormData();
        fd.append('type', type);
        fd.append('id', String(id));
        fd.append('file', fileInput.files[0]);
        const res = await fetch(TAX_RECEIPT_UPLOAD_URL, {
          method: 'POST',
          headers: { 'X-Admin-Password': adminPassword },
          body: fd
        });
        const data = await res.json();
        if (!data.ok) throw new Error(data.error || 'Receipt upload failed');
      }

      async function downloadTaxCsv() {
        const year = taxYearEl.value;
        const type = taxTypeEl.value;
        try {
          const res = await fetch(`${TAX_EXPORT_API_URL}?year=${encodeURIComponent(year)}&type=${encodeURIComponent(type)}`, {
            headers: { 'X-Admin-Password': adminPassword }
          });
          if (!res.ok) {
            const data = await res.json().catch(() => ({}));
            throw new Error(data.error || 'Export failed');
          }
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `eastern-shore-ai-tax-${year}-${type}.csv`;
          document.body.appendChild(a);
          a.click();
          a.remove();
          setTimeout(() => URL.revokeObjectURL(url), 1000);
        } catch (e) {
          alert(`Could not export CSV: ${e.message || e}`);
        }
      }

      function wireCollapse(btn, body) {
        if (!btn || !body) return;
        btn.addEventListener('click', () => {
          const isOpen = btn.getAttribute('aria-expanded') !== 'false';
          if (isOpen) {
            body.classList.add('admin-collapsible-body-collapsed');
            btn.setAttribute('aria-expanded', 'false');
            btn.textContent = 'Expand';
          } else {
            body.classList.remove('admin-collapsible-body-collapsed');
            btn.setAttribute('aria-expanded', 'true');
            btn.textContent = 'Minimize';
          }
        });
      }

      wireCollapse(bookingCollapseBtn, bookingControlsBody);
      wireCollapse(taxCollapseBtn, taxLedgerBody);

      adminUnlockBtn.addEventListener('click', async () => {
        const key = adminKeyEl.value.trim();
        if (!key) return;
        try {
          const res = await fetch(`${BOOKINGS_API_URL}?limit=1`, {
            headers: { 'X-Admin-Password': key }
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || 'Invalid password');
          adminPassword = key;
          setAdminUnlocked(true);
          const n = new Date();
          adminCalendarCursor = new Date(n.getFullYear(), n.getMonth(), 1);
          loadCategoryPrefs();
          initTaxUiDefaults();
          await loadAdminData();
          await loadTaxTransactions();
        } catch (e) {
          alert(`Admin unlock failed: ${e.message || e}`);
        }
      });

      adminBlockBtn.addEventListener('click', () => setBlockedSlot(true));
      adminUnblockBtn.addEventListener('click', () => setBlockedSlot(false));
      adminBlockDayBtn.addEventListener('click', () => setBlockedDay(true));
      adminUnblockDayBtn.addEventListener('click', () => setBlockedDay(false));
      adminRefreshBtn.addEventListener('click', loadAdminData);
      adminCalPrevBtn?.addEventListener('click', () => {
        const c = adminCalendarCursor || new Date();
        adminCalendarCursor = new Date(c.getFullYear(), c.getMonth() - 1, 1);
        loadAdminData();
      });
      adminCalNextBtn?.addEventListener('click', () => {
        const c = adminCalendarCursor || new Date();
        adminCalendarCursor = new Date(c.getFullYear(), c.getMonth() + 1, 1);
        loadAdminData();
      });

      taxRefreshBtn.addEventListener('click', loadTaxTransactions);
      taxYearEl.addEventListener('change', loadTaxTransactions);
      taxTypeEl.addEventListener('change', loadTaxTransactions);
      taxModeExpenseBtn?.addEventListener('click', () => setTaxEntryMode('expense'));
      taxModeIncomeBtn?.addEventListener('click', () => setTaxEntryMode('income'));
      window.openTaxCategoryManager = () => {
        if (!taxCategoryModal) {
          openErrorModal('Category manager is unavailable on this page load. Please refresh and try again.');
          return;
        }
        taxCategoryModal.classList.add('active');
        taxCategoryModal.setAttribute('aria-hidden', 'false');
        try {
          renderCategoryManagerLists();
        } catch (e) {
          openErrorModal(`Could not load category manager: ${e.message || e}`);
        }
      };
      taxManageCategoriesBtn?.addEventListener('click', window.openTaxCategoryManager);
      const closeTaxCategoryModal = () => {
        taxCategoryModal.classList.remove('active');
        taxCategoryModal.setAttribute('aria-hidden', 'true');
      };
      taxCategoryCloseBtn?.addEventListener('click', closeTaxCategoryModal);
      taxCategoryXBtn?.addEventListener('click', closeTaxCategoryModal);
      taxCategoryModal?.addEventListener('click', (e) => {
        if (e.target === taxCategoryModal) {
          taxCategoryModal.classList.remove('active');
          taxCategoryModal.setAttribute('aria-hidden', 'true');
        }
      });
      addExpenseCategoryBtn?.addEventListener('click', () => {
        const name = (newExpenseCategoryEl.value || '').trim();
        if (!name) return;
        if (TAX_EXPENSE_CATEGORIES.some(c => c.toLowerCase() === name.toLowerCase())) {
          openErrorModal('Expense category already exists.');
          return;
        }
        TAX_EXPENSE_CATEGORIES.push(name);
        newExpenseCategoryEl.value = '';
        saveCategoryPrefs();
        renderCategoryOptions();
        renderCategoryManagerLists();
        openSuccessModal('Expense category added.', 'Category Added ✅');
      });
      addIncomeCategoryBtn?.addEventListener('click', () => {
        const name = (newIncomeCategoryEl.value || '').trim();
        if (!name) return;
        if (TAX_INCOME_CATEGORIES.some(c => c.toLowerCase() === name.toLowerCase())) {
          openErrorModal('Income category already exists.');
          return;
        }
        TAX_INCOME_CATEGORIES.push(name);
        newIncomeCategoryEl.value = '';
        saveCategoryPrefs();
        renderCategoryOptions();
        renderCategoryManagerLists();
        openSuccessModal('Income category added.', 'Category Added ✅');
      });
      taxMinimizeExpenseBtn?.addEventListener('click', () => {
        const isHidden = taxExpenseFields?.style.display === 'none';
        if (taxExpenseFields) taxExpenseFields.style.display = isHidden ? '' : 'none';
        taxMinimizeExpenseBtn.textContent = isHidden ? 'Minimize' : 'Expand';
      });
      taxMinimizeIncomeBtn?.addEventListener('click', () => {
        const isHidden = taxIncomeFields?.style.display === 'none';
        if (taxIncomeFields) taxIncomeFields.style.display = isHidden ? '' : 'none';
        taxMinimizeIncomeBtn.textContent = isHidden ? 'Minimize' : 'Expand';
      });
      txFilterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          activeTxFilter = btn.getAttribute('data-filter');
          txFilterBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          txCategoryFilterEl.style.display = activeTxFilter === 'expense' ? '' : 'none';
          if (activeTxFilter !== 'expense') txCategoryFilterEl.value = '';
          renderTxList();
        });
      });
      txCategoryFilterEl.addEventListener('change', renderTxList);
      taxAddExpenseBtn.addEventListener('click', addTaxExpense);
      taxUpdateExpenseBtn.addEventListener('click', addTaxExpense);
      taxCancelExpenseEditBtn.addEventListener('click', clearTaxExpenseForm);
      taxClearExpenseBtn.addEventListener('click', clearTaxExpenseForm);
      taxAddIncomeBtn.addEventListener('click', addTaxIncome);
      taxUpdateIncomeBtn.addEventListener('click', addTaxIncome);
      taxCancelIncomeEditBtn.addEventListener('click', clearTaxIncomeForm);
      taxClearIncomeBtn.addEventListener('click', clearTaxIncomeForm);
      document.getElementById('tax-expense-receipt').addEventListener('change', function() {
        document.getElementById('tax-expense-receipt-name').textContent = this.files[0] ? this.files[0].name : 'No file chosen';
      });
      document.getElementById('tax-income-receipt').addEventListener('change', function() {
        document.getElementById('tax-income-receipt-name').textContent = this.files[0] ? this.files[0].name : 'No file chosen';
      });
      taxExportBtn.addEventListener('click', downloadTaxCsv);

      const taxZipBtn = document.getElementById('tax-zip-btn');
      if (taxZipBtn) {
        taxZipBtn.addEventListener('click', async () => {
          if (typeof JSZip === 'undefined') { alert('JSZip not loaded — try refreshing the page.'); return; }
          const year = taxYearEl.value;
          taxZipBtn.textContent = 'Building…';
          taxZipBtn.disabled = true;
          try {
            const zip = new JSZip();
            const folder = zip.folder(`eastern-shore-ai-tax-${year}`);

            // Fetch CSV
            const csvRes = await fetch(`${TAX_EXPORT_API_URL}?year=${encodeURIComponent(year)}&type=all`, {
              headers: { 'X-Admin-Password': adminPassword }
            });
            if (!csvRes.ok) throw new Error('CSV fetch failed');
            folder.file(`eastern-shore-ai-tax-${year}.csv`, await csvRes.blob());

            // Fetch all transactions to get receipt_keys
            const txRes = await fetch(`${TAX_TX_API_URL}?year=${encodeURIComponent(year)}&type=all&limit=5000`, {
              headers: { 'X-Admin-Password': adminPassword }
            });
            const txData = await txRes.json();
            const allRecords = [
              ...(txData.expenses || []).map(r => ({ ...r, recType: 'expense' })),
              ...(txData.income || []).map(r => ({ ...r, recType: 'income' }))
            ];

            const receiptsFolder = folder.folder('receipts');
            for (const r of allRecords) {
              if (!r.receipt_key) continue;
              const ext = r.receipt_key.split('.').pop();
              const filename = `${r.recType}-${r.id}-${r.date || ''}.${ext}`;
              const rRes = await fetch(`${TAX_RECEIPT_URL}?key=${encodeURIComponent(r.receipt_key)}&key2=${encodeURIComponent(adminPassword)}`);
              if (rRes.ok) receiptsFolder.file(filename, await rRes.blob());
            }

            const blob = await zip.generateAsync({ type: 'blob' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `eastern-shore-ai-tax-${year}.zip`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            setTimeout(() => URL.revokeObjectURL(a.href), 1000);
          } catch (e) {
            alert(`ZIP build failed: ${e.message || e}`);
          } finally {
            taxZipBtn.textContent = '⬇ Year Package (.zip)';
            taxZipBtn.disabled = false;
          }
        });
      }
    }

    bookPayBtn.addEventListener('click', async () => {
      const setupDate = setupDateEl.value;
      const setupTime = setupTimeEl.value;
      const name = document.getElementById('book-name')?.value.trim() || '';
      const email = document.getElementById('book-email')?.value.trim() || '';
      const phone = document.getElementById('book-phone')?.value.trim() || '';
      const preferredContactMethod = document.getElementById('book-preferred-contact-method')?.value || 'email';

      if (!name || !email) {
        openErrorModal('Name and email are required to book.');
        return;
      }

      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        openErrorModal('Please enter a valid email address.');
        return;
      }

      if (!setupDate || !setupTime) {
        openErrorModal('Please choose your setup date and time first.');
        return;
      }

      if (isPastEtSlot(setupDate, setupTime)) {
        openErrorModal('That time block has already passed (Eastern Time). Please choose another slot.');
        return;
      }

      if (slotIsUnavailable(setupDate, setupTime)) {
        openErrorModal('That slot is unavailable. Please choose another date/time.');
        return;
      }

      localStorage.setItem('esa_last_setup_slot', JSON.stringify({ setupDate, setupTime }));

      bookPayBtn.disabled = true;
      bookPayBtn.textContent = 'Redirecting…';

      try {
        const res = await fetch(CHECKOUT_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ setupDate, setupTime, name, email, phone, preferredContactMethod })
        });

        const data = await res.json();
        if (!res.ok || !data.checkoutUrl) throw new Error('Checkout session failed');
        window.location.href = data.checkoutUrl;
      } catch {
        openErrorModal('Could not start checkout right now. Please try again.');
        bookPayBtn.disabled = false;
        bookPayBtn.textContent = 'Book + Pay Now';
      }
    });

    const qs = new URLSearchParams(window.location.search);
    if (qs.get('paid') === '1') {
      let dateText = 'your selected date';
      let timeText = 'your selected time';
      try {
        const saved = JSON.parse(localStorage.getItem('esa_last_setup_slot') || '{}');
        if (saved.setupDate) dateText = saved.setupDate;
        if (saved.setupTime) timeText = saved.setupTime;
      } catch {}
      openSuccessModal(`Payment successful — you purchased an OpenClaw setup session ($100.00) for ${dateText} at ${timeText}.`, 'Payment Received — Setup Booked ✅');
      window.history.replaceState({}, '', '/openclaw-setup.html');
    } else if (qs.get('canceled') === '1') {
      let dateText = 'your selected date';
      let timeText = 'your selected time';
      try {
        const saved = JSON.parse(localStorage.getItem('esa_last_setup_slot') || '{}');
        if (saved.setupDate) dateText = saved.setupDate;
        if (saved.setupTime) timeText = saved.setupTime;
      } catch {}
      openSuccessModal(`Checkout canceled — no charge was made.`, 'Checkout Canceled');
      window.history.replaceState({}, '', '/openclaw-setup.html');
    }

    loadAvailability().then(() => {
      if (adminMode) loadAdminData();
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending…';
      statusEl.textContent = '';
      statusEl.className = 'form-status';
      try {
        const preferredDate = document.getElementById('setup-date').value;
        const preferredTime = document.getElementById('setup-time').value;
        const rawQuestions = document.getElementById('message').value.trim();
        const preferredContactMethod = document.getElementById('preferred-contact-method')?.value || 'email';
        const phone = document.getElementById('phone')?.value.trim() || '';
        const combinedMessage = `Preferred setup date: ${preferredDate || 'not provided'}\nPreferred time: ${preferredTime || 'not provided'}\nPreferred contact method: ${preferredContactMethod}\nPhone: ${phone || 'not provided'}\n\nQuestions:\n${rawQuestions}`;

        const res = await fetch(CONTACT_API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            mode: 'setup_questions',
            name: document.getElementById('name').value.trim(),
            email: document.getElementById('email').value.trim(),
            offer: '',
            message: combinedMessage,
            website: ''
          })
        });
        if (!res.ok) throw new Error('Request failed');
        statusEl.textContent = 'Questions sent successfully. We will respond to you within 24 hours.';
        statusEl.className = 'form-status ok';
        form.reset();
      } catch {
        statusEl.textContent = 'Could not send right now. Please try again.';
        statusEl.className = 'form-status err';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Questions';
      }
    });
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Service",
    "name": "OpenClaw Setup",
    "description": "Secure OpenClaw setup, hardening, and 30 days of technical support on the Eastern Shore of Maryland.",
    "provider": {
      "@type": "LocalBusiness",
      "name": "Eastern Shore AI",
      "url": "https://www.easternshore.ai"
    },
    "areaServed": {
      "@type": "Place",
      "name": "Eastern Shore Maryland"
    },
    "offers": {
      "@type": "Offer",
      "priceCurrency": "USD",
      "price": "100.00",
      "availability": "https://schema.org/InStock"
    }
  }
  </script>
  <!-- Brevo newsletter script -->
  <script>
    window.REQUIRED_CODE_ERROR_MESSAGE = 'Please choose a country code';
    window.LOCALE = 'en';
    window.EMAIL_INVALID_MESSAGE = window.SMS_INVALID_MESSAGE = "The information provided is invalid. Please review the field format and try again.";
    window.REQUIRED_ERROR_MESSAGE = "This field cannot be left blank. ";
    window.GENERIC_INVALID_MESSAGE = "The information provided is invalid. Please review the field format and try again.";
    window.translation = { common: { selectedList: '{quantity} list selected', selectedLists: '{quantity} lists selected', selectedOption: '{quantity} selected', selectedOptions: '{quantity} selected' } };
    var AUTOHIDE = Boolean(0);
  </script>
  <script defer src="https://sibforms.com/forms/end-form/build/main.js"></script>
</body>
</html>
